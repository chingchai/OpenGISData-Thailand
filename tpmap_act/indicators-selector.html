<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>เลือกตัวชี้วัดครัวเรือน TPMAP</title>

    <!-- Google Fonts: Inter + Noto Sans Thai -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Thai:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome 6 Free -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        :root {
            /* iOS 18 Modern Theme - Vibrant & Clean */
            --primary: #007AFF;
            --primary-light: #5EACFF;
            --primary-dark: #0051D5;
            --secondary: #34C759;
            --accent: #FF9500;
            --danger: #FF3B30;
            --purple: #AF52DE;
            --pink: #FF2D55;
            --teal: #5AC8FA;
            --indigo: #5856D6;
            --yellow: #FFCC00;

            /* Backgrounds - iOS Light Mode */
            --bg-main: #F2F2F7;
            --bg-card: #FFFFFF;
            --bg-hover: #F9F9FB;
            --bg-selected: #E8F0FE;

            /* Text Colors */
            --text-primary: #000000;
            --text-secondary: #8E8E93;
            --text-muted: #AEAEB2;
            --text-white: #FFFFFF;

            /* Border & Divider */
            --border-color: #C7C7CC;
            --border-light: #E5E5EA;
            --divider: #D1D1D6;

            /* Shadows - iOS Style */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);

            /* Spacing (following 8px grid) */
            --space-xs: 8px;
            --space-sm: 16px;
            --space-md: 24px;
            --space-lg: 32px;
            --space-xl: 48px;

            /* Border Radius - iOS Style */
            --radius-sm: 10px;
            --radius-md: 16px;
            --radius-lg: 20px;
            --radius-full: 9999px;

            /* Typography */
            --font-size-xs: 13px;
            --font-size-sm: 15px;
            --font-size-md: 17px;
            --font-size-lg: 22px;
            --font-size-xl: 28px;

            /* Legacy iOS compatibility (for existing code) */
            --ios-blue: var(--primary);
            --ios-green: var(--secondary);
            --ios-orange: var(--accent);
            --ios-red: var(--danger);
            --ios-gray: var(--text-secondary);
            --ios-gray2: var(--text-muted);
            --ios-gray3: var(--border-color);
            --ios-gray4: var(--border-light);
            --ios-gray5: var(--bg-hover);
            --ios-gray6: var(--bg-selected);
            --ios-background: var(--bg-main);
            --ios-card-bg: var(--bg-card);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            font-family: 'Inter', 'Noto Sans Thai', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
            padding: var(--space-md);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            text-align: center;
        }

        .header h1 {
            color: var(--primary);
            font-size: var(--font-size-xl);
            margin-bottom: var(--space-sm);
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: var(--font-size-md);
            font-weight: 400;
        }

        .stats-bar {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
            margin-top: var(--space-md);
            flex-wrap: wrap;
        }

        .stat-badge {
            background: var(--bg-card);
            padding: 12px 24px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-weight: 600;
            font-size: var(--font-size-sm);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .stat-badge:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-badge i {
            font-size: var(--font-size-md);
        }

        .stat-badge.total {
            color: var(--primary);
        }

        .stat-badge.selected {
            background: var(--secondary);
            color: var(--text-white);
            border-color: var(--secondary);
        }

        .category-section {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }

        .category-section:hover {
            box-shadow: var(--shadow-md);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--border-color);
        }

        .category-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .category-icon.health { background: var(--secondary); color: var(--text-white); }
        .category-icon.economy { background: var(--accent); color: var(--text-white); }
        .category-icon.education { background: var(--primary-light); color: var(--text-white); }
        .category-icon.welfare { background: var(--primary); color: var(--text-white); }
        .category-icon.social { background: var(--danger); color: var(--text-white); }

        .category-title {
            flex: 1;
        }

        .category-title h2 {
            font-size: var(--font-size-lg);
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.3px;
        }

        .category-title h2.health { color: var(--secondary); }
        .category-title h2.economy { color: var(--accent); }
        .category-title h2.education { color: var(--primary-light); }
        .category-title h2.welfare { color: var(--primary); }
        .category-title h2.social { color: var(--danger); }

        .category-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .category-count {
            background: var(--bg-selected);
            color: var(--text-secondary);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: var(--font-size-sm);
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-sm);
        }

        .indicator-card {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .indicator-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-4px);
        }

        .indicator-card.selected {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(127, 162, 132, 0.08), rgba(127, 162, 132, 0.12));
            box-shadow: var(--shadow-lg);
        }

        .indicator-card.selected::before {
            content: '✓';
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            color: var(--secondary);
            font-size: 24px;
            font-weight: 700;
        }

        .indicator-number {
            display: inline-block;
            background: var(--primary);
            color: var(--text-white);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            text-align: center;
            line-height: 40px;
            font-weight: 700;
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-sm);
        }

        .indicator-card.selected .indicator-number {
            background: var(--secondary);
        }

        .indicator-code {
            display: inline-block;
            background: var(--bg-selected);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: 600;
            margin-left: var(--space-xs);
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
        }

        .indicator-title {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: var(--space-xs);
        }

        .indicator-meta {
            display: flex;
            gap: var(--space-xs);
            flex-wrap: wrap;
            margin-top: var(--space-sm);
        }

        .meta-tag {
            background: var(--bg-hover);
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 500;
        }

        .action-buttons {
            position: fixed;
            bottom: var(--space-lg);
            right: var(--space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            z-index: 1000;
        }

        .fab-button {
            width: 64px;
            height: 64px;
            border-radius: var(--radius-full);
            border: none;
            color: var(--text-white);
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-button:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 12px 40px rgba(107, 88, 66, 0.2);
        }

        .fab-button:active {
            transform: scale(0.96);
        }

        .fab-button.primary {
            background: var(--primary);
        }

        .fab-button.success {
            background: var(--secondary);
        }

        .fab-button.danger {
            background: var(--danger);
        }

        .selection-panel {
            position: fixed;
            bottom: var(--space-lg);
            left: var(--space-lg);
            max-width: 440px;
            width: calc(100vw - 48px);
            max-height: 70vh;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-light);
            overflow: hidden;
            display: none;
            flex-direction: column;
        }

        .selection-panel.show {
            display: flex;
            animation: slideInLeft 0.3s ease;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .panel-header {
            padding: var(--space-md);
            background: var(--primary);
            color: var(--text-white);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h3 {
            font-size: var(--font-size-md);
            font-weight: 700;
        }

        .panel-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--text-white);
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .panel-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .panel-content {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .selected-item {
            background: white;
            border: 1px solid var(--ios-gray5);
            border-left: 4px solid var(--ios-green);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: start;
            gap: 10px;
        }

        .selected-item-number {
            background: var(--ios-green);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            text-align: center;
            line-height: 28px;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .selected-item-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--ios-gray);
        }

        .empty-state i {
            font-size: 64px;
            color: var(--ios-gray4);
            margin-bottom: 16px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.6em;
            }

            .indicators-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: row;
                bottom: 16px;
                right: 16px;
            }

            .fab-button {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .selection-panel {
                left: 16px;
                bottom: 80px;
                width: calc(100vw - 32px);
            }
        }

        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--ios-green);
            color: white;
            padding: 16px 24px;
            border-radius: 14px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideInRight 0.3s ease;
        }

        .toast.show {
            display: flex;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
            animation: fadeIn 0.2s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            position: relative;
            background: white;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: scaleIn 0.3s ease;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--ios-gray5);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            font-size: 1.3em;
            color: var(--ios-blue);
            margin: 0;
        }

        .modal-close {
            background: var(--ios-gray6);
            border: none;
            color: var(--ios-gray);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--ios-gray5);
        }

        .modal-body {
            padding: 20px 24px;
            overflow-y: auto;
            flex: 1;
        }

        .problem-option {
            background: white;
            border: 2px solid var(--ios-gray5);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: start;
            gap: 12px;
        }

        .problem-option:hover {
            border-color: var(--ios-blue);
            background: var(--ios-gray6);
        }

        .problem-option.selected {
            border-color: var(--ios-blue);
            background: rgba(0, 122, 255, 0.1);
        }

        .problem-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--ios-gray3);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .problem-option.selected .problem-checkbox {
            background: var(--ios-blue);
            border-color: var(--ios-blue);
        }

        .problem-checkbox i {
            color: white;
            font-size: 12px;
            display: none;
        }

        .problem-option.selected .problem-checkbox i {
            display: block;
        }

        .problem-text {
            flex: 1;
            font-size: 0.95em;
            line-height: 1.5;
            color: #333;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--ios-gray5);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn-primary, .btn-secondary {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--ios-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #0051d5;
        }

        .btn-secondary {
            background: var(--ios-gray6);
            color: var(--ios-gray);
        }

        .btn-secondary:hover {
            background: var(--ios-gray5);
        }

        /* Success Tooltip (bottom-right) */
        .success-tooltip {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--ios-green);
            color: white;
            padding: 16px 24px;
            border-radius: 14px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideInUp 0.3s ease;
        }

        .success-tooltip.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Button Group */
        .button-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 32px 0;
            flex-wrap: wrap;
        }

        .btn-generate {
            background: var(--primary);
            color: var(--text-white);
            padding: 16px 40px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
        }

        .btn-generate:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-generate:active {
            transform: translateY(0);
        }

        .btn-copy {
            background: var(--secondary);
            color: var(--text-white);
            padding: 16px 40px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
        }

        .btn-copy:hover {
            background: #6A8E6F;
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-copy:active {
            transform: translateY(0);
        }

        .btn-reset {
            background: var(--danger);
            color: var(--text-white);
            padding: 16px 40px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
        }

        .btn-reset:hover {
            background: #B57760;
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-reset:active {
            transform: translateY(0);
        }

        /* Output Section */
        .output-section {
            margin: var(--space-lg) 0;
            padding: var(--space-lg);
            background: var(--bg-hover);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .output-section.show {
            display: block;
        }

        .output-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            letter-spacing: -0.3px;
        }

        .output-content {
            background: var(--bg-card);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            white-space: pre-wrap;
            font-family: 'Inter', 'Noto Sans Thai', sans-serif;
            line-height: 1.8;
            font-size: var(--font-size-sm);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            max-height: 500px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }

            .btn-generate,
            .btn-copy,
            .btn-reset {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-clipboard-check"></i> เลือกตัวชี้วัดครัวเรือน TPMAP</h1>
            <p>เลือกตัวชี้วัดที่ต้องการวิเคราะห์ตามมิติต่างๆ (เลือกได้มากกว่า 1 รายการ)</p>

            <div class="stats-bar">
                <div class="stat-badge total">
                    <i class="fas fa-list"></i>
                    <span>ทั้งหมด: <strong id="totalCount">38</strong> ตัวชี้วัด</span>
                </div>
                <div class="stat-badge selected">
                    <i class="fas fa-check-circle"></i>
                    <span>เลือกแล้ว: <strong id="selectedCount">0</strong> รายการ</span>
                </div>
            </div>
        </div>

        <!-- ด้านสุขภาพ -->
        <div class="category-section">
            <div class="category-header">
                <div class="category-icon health">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="category-title">
                    <h2 class="health">ด้านสุขภาพ (Health)</h2>
                    <span class="category-subtitle">สุขภาพแม่และเด็ก, การดูแลสุขภาพ, และพฤติกรรมสุขภาพ</span>
                </div>
                <div class="category-count">12 ตัวชี้วัด</div>
            </div>
            <div class="indicators-grid">
                <div class="indicator-card" data-id="1" data-code="H01" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">1</span>
                        <span class="indicator-code">H01</span>
                    </div>
                    <div class="indicator-title">การฝากครรภ์อย่างมีคุณภาพ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สุขภาพแม่และเด็ก</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="2" data-code="H02" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">2</span>
                        <span class="indicator-code">H02</span>
                    </div>
                    <div class="indicator-title">เด็กแรกเกิดมีน้ำหนัก 2,500 กรัมขึ้นไป</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สุขภาพแม่และเด็ก</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="3" data-code="H03" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">3</span>
                        <span class="indicator-code">H03</span>
                    </div>
                    <div class="indicator-title">เด็กแรกเกิดได้กินนมแม่อย่างเดียวอย่างน้อย 6 เดือน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สุขภาพแม่และเด็ก</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="4" data-code="H04" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">4</span>
                        <span class="indicator-code">H04</span>
                    </div>
                    <div class="indicator-title">เด็กแรกเกิดถึง 12 ปี ได้รับวัคซีนครบตามตาราง</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สุขภาพเด็ก</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="5" data-code="H05" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">5</span>
                        <span class="indicator-code">H05</span>
                    </div>
                    <div class="indicator-title">เด็กได้รับการดูแลและมีพัฒนาการเหมาะสม</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สุขภาพเด็ก</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="6" data-code="H06" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">6</span>
                        <span class="indicator-code">H06</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนกินอาหารถูกสุขลักษณะ ปลอดภัย ได้มาตรฐาน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">พฤติกรรมสุขภาพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="7" data-code="H07" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">7</span>
                        <span class="indicator-code">H07</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีความรู้และป้องกันตนเองจากปัจจัยเสี่ยงสุขภาวะ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">พฤติกรรมสุขภาพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="8" data-code="H08" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">8</span>
                        <span class="indicator-code">H08</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนสามารถดูแลตนเอง/สมาชิกเมื่อเจ็บป่วยเบื้องต้น</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การดูแลสุขภาพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="9" data-code="H09" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">9</span>
                        <span class="indicator-code">H09</span>
                    </div>
                    <div class="indicator-title">คนอายุ 6 ปีขึ้นไป ออกกำลังกายสม่ำเสมอ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">พฤติกรรมสุขภาพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="10" data-code="H10" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">10</span>
                        <span class="indicator-code">H10</span>
                    </div>
                    <div class="indicator-title">ผู้ป่วยติดเตียงได้รับการดูแลจากครอบครัว/ชุมชน/ภาครัฐ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การดูแลสุขภาพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="11" data-code="H11" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">11</span>
                        <span class="indicator-code">H11</span>
                    </div>
                    <div class="indicator-title">คนในครัวเรือนมีประกันสุขภาพ/สิทธิรักษาพยาบาล และทราบสถานที่ใช้สิทธิ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การดูแลสุขภาพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="12" data-code="H12" data-category="สุขภาพ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">12</span>
                        <span class="indicator-code">H12</span>
                    </div>
                    <div class="indicator-title">คนอายุ 35 ปีขึ้นไป ได้รับการตรวจสุขภาพประจำปี</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การดูแลสุขภาพ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ด้านที่อยู่อาศัยและสิ่งแวดล้อม -->
        <div class="category-section">
            <div class="category-header">
                <div class="category-icon economy">
                    <i class="fas fa-home"></i>
                </div>
                <div class="category-title">
                    <h2 class="economy">ด้านที่อยู่อาศัยและสิ่งแวดล้อม (Housing & Environment)</h2>
                    <span class="category-subtitle">ที่อยู่อาศัย, สิ่งแวดล้อม, สาธารณูปโภค และความปลอดภัย</span>
                </div>
                <div class="category-count">9 ตัวชี้วัด</div>
            </div>
            <div class="indicators-grid">
                <div class="indicator-card" data-id="13" data-code="HE01" data-category="ที่อยู่อาศัย" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">13</span>
                        <span class="indicator-code">HE01</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีความมั่นคงในที่อยู่อาศัย บ้านมีสภาพคงทนถาวร</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ที่อยู่อาศัย</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="14" data-code="HE02" data-category="สิ่งแวดล้อม" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">14</span>
                        <span class="indicator-code">HE02</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีการจัดบ้านเรือนและได้รับบริการจัดเก็บขยะมูลฝอยที่ถูกสุขลักษณะ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สิ่งแวดล้อม</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="15" data-code="HE03" data-category="สิ่งแวดล้อม" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">15</span>
                        <span class="indicator-code">HE03</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนไม่ถูกรบกวนจากมลพิษ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สิ่งแวดล้อม</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="16" data-code="HE04" data-category="ความปลอดภัย" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">16</span>
                        <span class="indicator-code">HE04</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีการป้องกันอุบัติภัยอย่างถูกวิธี และเตรียมความพร้อมรับมือภัยพิบัติ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ความปลอดภัย</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="17" data-code="HE05" data-category="ความปลอดภัย" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">17</span>
                        <span class="indicator-code">HE05</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีความปลอดภัยในชีวิตและทรัพย์สิน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ความปลอดภัย</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="18" data-code="HE06" data-category="สาธารณูปโภค" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">18</span>
                        <span class="indicator-code">HE06</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีน้ำสำหรับบริโภคและอุปโภคเพียงพอตลอดปี</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สาธารณูปโภค</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="19" data-code="HE07" data-category="สาธารณูปโภค" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">19</span>
                        <span class="indicator-code">HE07</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนเข้าถึงไฟฟ้าและใช้บริการไฟฟ้า</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สาธารณูปโภค</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="20" data-code="HE08" data-category="สาธารณูปโภค" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">20</span>
                        <span class="indicator-code">HE08</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนเข้าถึงและใช้บริการโทรศัพท์เคลื่อนที่และอินเทอร์เน็ต</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สาธารณูปโภค</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="21" data-code="HE09" data-category="สาธารณูปโภค" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">21</span>
                        <span class="indicator-code">HE09</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนเข้าถึงบริการขนส่งสาธารณะ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สาธารณูปโภค</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ด้านการศึกษา -->
        <div class="category-section">
            <div class="category-header">
                <div class="category-icon education">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="category-title">
                    <h2 class="education">ด้านการศึกษาและการเรียนรู้ (Education)</h2>
                    <span class="category-subtitle">การศึกษาภาคบังคับ, พัฒนาการ และทักษะการเรียนรู้</span>
                </div>
                <div class="category-count">5 ตัวชี้วัด</div>
            </div>
            <div class="indicators-grid">
                <div class="indicator-card" data-id="22" data-code="ED01" data-category="การศึกษา" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">22</span>
                        <span class="indicator-code">ED01</span>
                    </div>
                    <div class="indicator-title">เด็กอายุต่ำกว่า 6 ปี มีพัฒนาการด้านสุขภาพ การเรียนรู้ และพัฒนาการทางบุคลิกภาพตามวัย</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">พัฒนาการเด็ก</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="23" data-code="ED02" data-category="การศึกษา" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">23</span>
                        <span class="indicator-code">ED02</span>
                    </div>
                    <div class="indicator-title">เด็กอายุ 6–15 ปี ได้รับการศึกษาภาคบังคับ 9 ปี</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การศึกษาภาคบังคับ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="24" data-code="ED03" data-category="การศึกษา" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">24</span>
                        <span class="indicator-code">ED03</span>
                    </div>
                    <div class="indicator-title">เด็กจบชั้น ม.3 ได้เรียนต่อชั้น ม.4 หรือเทียบเท่า</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การศึกษาต่อเนื่อง</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="25" data-code="ED04" data-category="การศึกษา" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">25</span>
                        <span class="indicator-code">ED04</span>
                    </div>
                    <div class="indicator-title">คนอายุ 15–59 ปี อ่าน เขียนภาษาไทย ภาษาอังกฤษ และคิดเลขอย่างง่ายได้</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ทักษะพื้นฐาน</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="26" data-code="ED05" data-category="การศึกษา" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">26</span>
                        <span class="indicator-code">ED05</span>
                    </div>
                    <div class="indicator-title">เด็ก เยาวชน/ผู้ใหญ่ มีทักษะการเรียนรู้ที่จำเป็นในศตวรรษที่ 21</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ทักษะศตวรรษที่ 21</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ด้านเศรษฐกิจ -->
        <div class="category-section">
            <div class="category-header">
                <div class="category-icon economy">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="category-title">
                    <h2 class="economy">ด้านเศรษฐกิจและอาชีพ (Economy)</h2>
                    <span class="category-subtitle">อาชีพ, รายได้ และการออม</span>
                </div>
                <div class="category-count">4 ตัวชี้วัด</div>
            </div>
            <div class="indicators-grid">
                <div class="indicator-card" data-id="27" data-code="EC01" data-category="เศรษฐกิจ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">27</span>
                        <span class="indicator-code">EC01</span>
                    </div>
                    <div class="indicator-title">คนอายุ 15–59 ปี มีอาชีพและรายได้</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">อาชีพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="28" data-code="EC02" data-category="เศรษฐกิจ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">28</span>
                        <span class="indicator-code">EC02</span>
                    </div>
                    <div class="indicator-title">คนอายุ 60 ปีขึ้นไป มีอาชีพและรายได้</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">อาชีพ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="29" data-code="EC03" data-category="เศรษฐกิจ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">29</span>
                        <span class="indicator-code">EC03</span>
                    </div>
                    <div class="indicator-title">รายได้เฉลี่ยของคนในครัวเรือนต่อปี</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">รายได้</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="30" data-code="EC04" data-category="เศรษฐกิจ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">30</span>
                        <span class="indicator-code">EC04</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีการเก็บออมเงิน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การออม</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ด้านสวัสดิการสังคม -->
        <div class="category-section">
            <div class="category-header">
                <div class="category-icon welfare">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <div class="category-title">
                    <h2 class="welfare">ด้านสวัสดิการสังคม (Social Welfare)</h2>
                    <span class="category-subtitle">สวัสดิการ, การคุ้มครองทางสังคม และการดูแลกลุ่มเปราะบาง</span>
                </div>
                <div class="category-count">5 ตัวชี้วัด</div>
            </div>
            <div class="indicators-grid">
                <div class="indicator-card" data-id="31" data-code="W01" data-category="สวัสดิการ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">31</span>
                        <span class="indicator-code">W01</span>
                    </div>
                    <div class="indicator-title">เด็กแรกเกิด–6 ปี ที่ครัวเรือนมีรายได้ไม่เกิน 100,000 บาท/คน/ปี ได้รับเงินอุดหนุน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">สวัสดิการเด็ก</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="32" data-code="W02" data-category="สวัสดิการ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">32</span>
                        <span class="indicator-code">W02</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนที่มีรายได้ไม่เกิน 100,000 บาท/ปี ได้รับเงินสวัสดิการแห่งรัฐ</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">บัตรสวัสดิการ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="33" data-code="W03" data-category="สวัสดิการ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">33</span>
                        <span class="indicator-code">W03</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนได้รับการคุ้มครองตามระบบและมาตรการคุ้มครองทางสังคม</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">การคุ้มครอง</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="34" data-code="W04" data-category="สวัสดิการ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">34</span>
                        <span class="indicator-code">W04</span>
                    </div>
                    <div class="indicator-title">ผู้สูงอายุได้รับการดูแลจากครอบครัว ชุมชน ภาครัฐ หรือภาคเอกชน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ผู้สูงอายุ</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="35" data-code="W05" data-category="สวัสดิการ" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">35</span>
                        <span class="indicator-code">W05</span>
                    </div>
                    <div class="indicator-title">ผู้พิการได้รับการดูแลจากครอบครัว ชุมชน ภาครัฐ หรือภาคเอกชน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ผู้พิการ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ด้านครอบครัวและชุมชน -->
        <div class="category-section">
            <div class="category-header">
                <div class="category-icon social">
                    <i class="fas fa-users"></i>
                </div>
                <div class="category-title">
                    <h2 class="social">ด้านครอบครัวและชุมชน (Family & Community)</h2>
                    <span class="category-subtitle">ความอบอุ่นในครอบครัวและการมีส่วนร่วมในชุมชน</span>
                </div>
                <div class="category-count">2 ตัวชี้วัด</div>
            </div>
            <div class="indicators-grid">
                <div class="indicator-card" data-id="36" data-code="FC01" data-category="ครอบครัว" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">36</span>
                        <span class="indicator-code">FC01</span>
                    </div>
                    <div class="indicator-title">ครอบครัวมีความอบอุ่น</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ครอบครัว</span>
                    </div>
                </div>

                <div class="indicator-card" data-id="38" data-code="FC02" data-category="ชุมชน" onclick="toggleIndicator(this)">
                    <div>
                        <span class="indicator-number">38</span>
                        <span class="indicator-code">FC02</span>
                    </div>
                    <div class="indicator-title">ครัวเรือนมีส่วนร่วมทำกิจกรรมสาธารณะเพื่อประโยชน์ของชุมชน</div>
                    <div class="indicator-meta">
                        <span class="meta-tag">ชุมชน</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Button Group -->
        <div class="button-group">
            <button type="button" class="btn-generate" onclick="generateOutput()">
                <i class="fas fa-file-alt"></i> สร้างข้อความ
            </button>
            <button type="button" class="btn-copy" onclick="copyOutputToClipboard()">
                <i class="fas fa-copy"></i> คัดลอกข้อความ
            </button>
            <button type="button" class="btn-reset" onclick="resetSelection()">
                <i class="fas fa-redo"></i> ล้างข้อมูล
            </button>
        </div>

        <!-- Output Section -->
        <div id="outputSection" class="output-section">
            <div class="output-title">
                <i class="fas fa-check-circle"></i>
                <span>ผลลัพธ์</span>
            </div>
            <div id="outputContent" class="output-content"></div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <button class="fab-button primary" onclick="toggleSelectionPanel()" title="แสดงรายการที่เลือก">
            <i class="fas fa-list"></i>
        </button>
        <button class="fab-button success" onclick="exportSelection()" title="ส่งออกรายการ">
            <i class="fas fa-download"></i>
        </button>
        <button class="fab-button danger" onclick="clearSelection()" title="ล้างการเลือกทั้งหมด">
            <i class="fas fa-trash"></i>
        </button>
    </div>

    <!-- Selection Panel -->
    <div class="selection-panel" id="selectionPanel">
        <div class="panel-header">
            <h3><i class="fas fa-check-double"></i> รายการที่เลือก</h3>
            <button class="panel-close" onclick="toggleSelectionPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-content" id="panelContent">
            <div class="empty-state">
                <i class="fas fa-clipboard-list"></i>
                <p>ยังไม่มีรายการที่เลือก<br>คลิกที่ตัวชี้วัดเพื่อเลือก</p>
            </div>
        </div>
    </div>

    <!-- Problem Selection Modal -->
    <div class="modal" id="problemModal">
        <div class="modal-overlay" onclick="closeProblemModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalIndicatorTitle">เลือกปัญหาที่เกี่ยวข้อง</h3>
                <button class="modal-close" onclick="closeProblemModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalProblemsContainer">
                <!-- Problems will be populated here -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeProblemModal()">
                    <i class="fas fa-times"></i> ยกเลิก
                </button>
                <button class="btn-primary" onclick="confirmProblemSelection()">
                    <i class="fas fa-check"></i> ยืนยันการเลือก
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">สำเร็จ!</span>
    </div>

    <!-- Success Message (for copy action) -->
    <div class="success-tooltip" id="successTooltip">
        <i class="fas fa-check-circle"></i>
        <span>คัดลอกสำเร็จ!</span>
    </div>

    <script>
        let selectedIndicators = [];

        // ข้อมูลความสัมพันธ์ระหว่างตัวชี้วัดและปัญหา
        const indicatorProblems = {
            '1': [
                'หญิงตั้งครรภ์ไม่ได้รับความรู้เรื่องการฝากครรภ์หรือเข้าใจผิดเกี่ยวกับระยะเวลาฝากครรภ์ครั้งแรก',
                'ขาดการเข้าถึงบริการฝากครรภ์ เช่น อยู่ห่างจากสถานบริการ หรือไม่มีรถรับส่ง',
                'ภาระงานในครอบครัวและเศรษฐกิจ ทำให้ละเลยการมาตรวจตามนัดครบถ้วน'
            ],
            '2': [
                'แม่มีภาวะโภชนาการไม่เหมาะสมระหว่างตั้งครรภ์ (ขาดสารอาหาร/รับประทานอาหารไม่ครบ 5 หมู่)',
                'แม่มีโรคประจำตัวหรือภาวะเสี่ยง เช่น ความดันโลหิตสูง เบาหวาน หรือสูบบุหรี่',
                'ขาดการฝากครรภ์และติดตามสุขภาพครรภ์อย่างต่อเนื่อง'
            ],
            '3': [
                'แม่ต้องกลับไปทำงานเร็ว ไม่มีสถานที่หรือเวลาให้นม/ปั๊มนม',
                'ขาดความรู้เรื่องประโยชน์ของการเลี้ยงลูกด้วยนมแม่',
                'ได้รับคำแนะนำที่ไม่ถูกต้อง เช่น ให้กินนมผสมเร็วเกินไป'
            ],
            '4': [
                'ผู้ปกครองไม่ทราบกำหนดการรับวัคซีนครบตามช่วงวัย',
                'อาศัยอยู่ห่างจากสถานบริการ หรือไม่สะดวกเดินทาง',
                'บางกรณีผู้ปกครองมีความกังวลหรือความเชื่อผิดเกี่ยวกับผลข้างเคียงของวัคซีน'
            ],
            '5': [
                'ผู้ปกครองขาดความรู้เรื่องการส่งเสริมพัฒนาการเด็กตามวัย',
                'เด็กอยู่กับผู้สูงอายุที่ขาดทักษะการกระตุ้นพัฒนาการ',
                'เด็กได้รับสื่อหรืออาหารที่ไม่เหมาะสม ส่งผลต่อสุขภาพและสมาธิ'
            ],
            '6': [
                'ขาดความรู้เรื่องการเลือกซื้ออาหารปลอดภัยและการเก็บรักษาอาหารอย่างถูกวิธี',
                'แหล่งอาหารในชุมชนไม่สะอาด เช่น ตลาดสดขาดการควบคุมสุขาภิบาล',
                'รายได้จำกัด ทำให้เลือกบริโภคอาหารราคาถูกแต่ไม่ปลอดภัย'
            ],
            '7': [
                'ขาดการเข้าถึงข้อมูลสุขภาพ เช่น การป้องกันโรคติดต่อ การใช้ยาอย่างถูกวิธี',
                'พฤติกรรมเสี่ยง เช่น ดื่มสุรา สูบบุหรี่ หรือไม่สวมหมวกกันน็อก',
                'ขาดการจัดกิจกรรมรณรงค์สุขภาพในระดับหมู่บ้าน/ชุมชนอย่างต่อเนื่อง'
            ],
            '8': [
                'ขาดความรู้เรื่องการปฐมพยาบาลและการใช้ยาพื้นฐาน',
                'ไม่มีอุปกรณ์ปฐมพยาบาลเบื้องต้นในบ้าน',
                'พึ่งพาสถานพยาบาลทุกครั้งโดยไม่สามารถดูแลตนเองเบื้องต้นได้'
            ],
            '9': [
                'ไม่มีพื้นที่หรืออุปกรณ์สำหรับออกกำลังกายในชุมชน',
                'ขาดแรงจูงใจและความรู้เรื่องประโยชน์ของการออกกำลังกาย',
                'พฤติกรรมติดสื่อ/โทรศัพท์มากเกินไป ทำให้ไม่มีกิจกรรมทางกาย'
            ],
            '10': [
                'ครอบครัวไม่มีความรู้หรืออุปกรณ์ในการดูแลผู้ป่วยติดเตียง',
                'ขาดการเยี่ยมบ้านและติดตามจากภาคีเครือข่ายภาครัฐหรือ อสม.',
                'ปัญหาภาระค่าใช้จ่ายและการเข้าถึงสิทธิ์บริการสาธารณสุข'
            ],
            '11': [
                'ไม่เข้าใจระบบสิทธิประกันสุขภาพ เช่น บัตรทอง/ประกันสังคม/ข้าราชการ',
                'ย้ายที่อยู่แต่ยังไม่เปลี่ยนหน่วยบริการประจำ ทำให้ใช้สิทธิไม่ได้',
                'ขาดการประชาสัมพันธ์ข้อมูลสิทธิ์และช่องทางตรวจสอบสิทธิในพื้นที่'
            ],
            '12': [
                'ไม่เห็นความสำคัญของการตรวจสุขภาพเพราะไม่มีอาการเจ็บป่วย',
                'ขาดเวลาหรือไม่สะดวกเดินทางไปตรวจตามนัด',
                'สถานบริการไม่เพียงพอหรือขั้นตอนซับซ้อน ทำให้ไม่อยากเข้ารับบริการ'
            ],
            '13': [
                'บ้านพักอาศัยทรุดโทรม ผนัง/หลังคา/พื้นไม่มั่นคง เสี่ยงต่อการพังถล่ม',
                'ไม่มีเอกสารสิทธิ์ในที่ดิน ทำให้ขาดความมั่นคงและเข้าถึงโครงการซ่อมแซมไม่ได้',
                'บ้านอยู่ในพื้นที่เสี่ยงน้ำท่วม ดินสไลด์ หรือแหล่งมลพิษ ทำให้สภาพแวดล้อมไม่เหมาะสมต่อการอยู่อาศัย'
            ],
            '14': [
                'ไม่มีระบบจัดเก็บขยะในหมู่บ้าน หรือรถเก็บขยะมาไม่สม่ำเสมอ',
                'ครัวเรือนไม่มีจุดทิ้งขยะที่ถูกสุขลักษณะ มีการเผาขยะหรือลงขยะในลำคลอง',
                'ขาดความรู้ในการคัดแยกขยะและการจัดการขยะเปียก/ขยะอันตรายภายในครัวเรือน'
            ],
            '15': [
                'มีกลิ่น/ควัน/เสียงจากโรงงานหรือการเกษตรในพื้นที่รบกวน',
                'มีการใช้สารเคมีทางการเกษตรใกล้แหล่งที่อยู่อาศัย ทำให้เกิดผลกระทบต่อสุขภาพ',
                'น้ำในลำคลองหรือแหล่งน้ำสาธารณะปนเปื้อนจากน้ำเสียของชุมชน'
            ],
            '16': [
                'ขาดแผนหรือคู่มือการรับมือภัยพิบัติในระดับครัวเรือน',
                'ไม่มีอุปกรณ์ดับเพลิง/ป้องกันไฟฟ้าลัดวงจร หรือไม่มีจุดอพยพที่ชัดเจน',
                'ขาดความรู้เรื่องการปฐมพยาบาลและการอพยาบาลเมื่อเกิดภัย เช่น น้ำท่วม ไฟไหม้'
            ],
            '17': [
                'บ้านไม่มีอุปกรณ์รักษาความปลอดภัย เช่น กลอนประตู รั้ว หรือไฟส่องสว่าง',
                'พื้นที่มีเหตุอาชญากรรม/ทะเลาะวิวาท/ยาเสพติดบ่อยครั้ง',
                'ขาดความร่วมมือระหว่างชุมชนกับเจ้าหน้าที่ในการเฝ้าระวังเหตุร้าย'
            ],
            '18': [
                'ขาดระบบประปาหมู่บ้านหรือประปาใช้น้ำไม่เพียงพอในฤดูแล้ง',
                'น้ำอุปโภคบริโภคมีคุณภาพต่ำ ไม่ผ่านการกรองหรือปนเปื้อน',
                'ไม่มีภาชนะหรือถังเก็บน้ำสำรองในช่วงขาดแคลน'
            ],
            '19': [
                'บ้านอยู่ห่างไกลแนวสายไฟฟ้า หรือยังไม่มีการขยายเขตไฟฟ้าเข้าถึง',
                'ระบบไฟฟ้าภายในบ้านไม่ได้มาตรฐาน เสี่ยงไฟฟ้าลัดวงจร',
                'มีปัญหาการชำระค่าไฟฟ้า ทำให้ถูกตัดไฟเป็นระยะ'
            ],
            '20': [
                'พื้นที่สัญญาณโทรศัพท์/อินเทอร์เน็ตอ่อนหรือไม่ครอบคลุม',
                'ครัวเรือนมีอุปกรณ์ไม่พร้อม เช่น ไม่มีสมาร์ทโฟนหรือ Wi-Fi',
                'ขาดทักษะการใช้เทคโนโลยีดิจิทัล ทำให้ไม่สามารถเข้าถึงบริการออนไลน์ได้เต็มที่'
            ],
            '21': [
                'ไม่มีรถโดยสารสาธารณะผ่านหมู่บ้าน หรือมีรอบให้บริการน้อยมาก',
                'ถนนเชื่อมต่อกับแหล่งบริการหลักอยู่ในสภาพชำรุดหรือถูกตัดขาดช่วงฤดูฝน',
                'ค่าใช้จ่ายในการเดินทางสูง ทำให้ไม่สะดวกต่อการเข้าถึงบริการต่าง ๆ เช่น โรงเรียน โรงพยาบาล'
            ],
            '22': [
                'เด็กมีพัฒนาการล่าช้าหรือบกพร่องจากภาวะสุขภาพ เช่น โรคประจำตัวแต่กำเนิด หรือภาวะเจ็บป่วยเรื้อรัง',
                'ผู้ปกครองขาดความรู้ในการส่งเสริมพัฒนาการตามวัย เช่น การเล่น การอ่านนิทาน การสื่อสาร',
                'เด็กไม่ได้รับการตรวจพัฒนาการตามช่วงวัยจากสถานบริการสาธารณสุข'
            ],
            '23': [
                'เด็กหลุดจากระบบการศึกษา เนื่องจากฐานะยากจนหรือครอบครัวไม่สนับสนุน',
                'โรงเรียนอยู่ห่างไกล ไม่มีระบบขนส่งที่ปลอดภัย หรือค่าเดินทางสูง',
                'เด็กต้องช่วยงานครอบครัว ทำให้ขาดเรียนบ่อยและเสี่ยงต่อการออกกลางคัน'
            ],
            '24': [
                'ขาดทุนทรัพย์ในการเรียนต่อ โดยเฉพาะในระดับมัธยมปลายหรืออาชีวศึกษา',
                'เด็กมีภาระดูแลผู้สูงอายุหรือผู้พิการ ทำให้ไม่ได้เรียนต่อ',
                'ไม่มีแรงจูงใจหรือแนวทางอาชีพที่ชัดเจน ครอบครัวหรือผู้ปกครองไม่เห็นความสำคัญของการศึกษาต่อ'
            ],
            '25': [
                'ผู้ใหญ่บางส่วนจบการศึกษาน้อย ไม่ได้ฝึกทักษะการอ่านเขียนต่อเนื่อง ทำให้ลืมความรู้พื้นฐาน',
                'ขาดโอกาสเข้าร่วมโครงการการศึกษาต่อเนื่องหรือการศึกษานอกระบบ',
                'ไม่มีสื่อการเรียนรู้ที่เหมาะสมกับผู้ใหญ่ เช่น หนังสืออ่านง่ายหรือหลักสูตรพัฒนาอาชีพควบคู่'
            ],
            '26': [
                'ขาดการฝึกทักษะชีวิต เช่น การสื่อสาร การทำงานเป็นทีม การคิดวิเคราะห์ และการแก้ปัญหา',
                'ไม่มีโอกาสเข้าถึงกิจกรรมหรือหลักสูตรฝึกอบรมด้านดิจิทัล เทคโนโลยี หรืออาชีพใหม่',
                'โรงเรียน/ศูนย์การเรียนรู้ในพื้นที่ยังไม่บูรณาการการเรียนรู้เชิงสร้างสรรค์และการใช้เทคโนโลยี'
            ],
            '27': [
                'ขาดทักษะอาชีพที่สอดคล้องกับความต้องการของตลาดแรงงาน หรือขาดการพัฒนาอาชีพต่อเนื่อง',
                'ขาดโอกาสในการเข้าถึงแหล่งทุนเริ่มต้นประกอบอาชีพ เช่น กองทุนพัฒนาบทบาทสตรี กข.คจ. หรือสินเชื่อธนาคารรัฐ',
                'มีงานทำแต่รายได้ไม่มั่นคง เช่น ทำงานไม่ประจำ รับจ้างรายวัน หรืออาชีพตามฤดูกาล'
            ],
            '28': [
                'ผู้สูงอายุมีข้อจำกัดด้านสุขภาพ ไม่สามารถประกอบอาชีพหนักหรือใช้แรงงานได้',
                'ขาดโอกาสในการพัฒนาอาชีพที่เหมาะสมกับวัย เช่น งานฝีมือ งานบริการ หรือเกษตรปลอดภัย',
                'พึ่งพารายได้จากเบี้ยยังชีพผู้สูงอายุเพียงอย่างเดียว ไม่มีรายได้เสริมจากครอบครัวหรือชุมชน'
            ],
            '29': [
                'รายได้ครัวเรือนต่ำกว่ามาตรฐานความจำเป็นพื้นฐาน (จปฐ.) หรือเส้นความยากจน',
                'สมาชิกในครัวเรือนส่วนใหญ่มีอาชีพไม่มั่นคง รายได้ขึ้นกับฤดูกาล เช่น เกษตรกรรม รับจ้างทั่วไป',
                'ขาดการบริหารจัดการรายรับรายจ่ายในครัวเรือน ทำให้รายได้ไม่เพียงพอต่อค่าใช้จ่ายประจำ'
            ],
            '30': [
                'ครัวเรือนไม่มีรายได้เพียงพอสำหรับเก็บออม เนื่องจากภาระค่าใช้จ่ายสูง',
                'ขาดความรู้ด้านการวางแผนการเงินและการออมอย่างเป็นระบบ',
                'ไม่มีช่องทางหรือแรงจูงใจในการออม เช่น กลุ่มออมทรัพย์ กองทุนชุมชน หรือบัญชีธนาคาร'
            ],
            '31': [
                'ครอบครัวขาดความรู้หรือเข้าไม่ถึงช่องทางการลงทะเบียนขอรับเงินอุดหนุนเด็กแรกเกิด',
                'เอกสารหลักฐานไม่ครบถ้วน เช่น สูติบัตร บัตรประชาชน หรือทะเบียนบ้าน ทำให้ไม่สามารถยื่นขอสิทธิได้',
                'ระบบการติดตามสิทธิขาดความต่อเนื่อง เด็กบางรายหลุดจากระบบการรับเงินอุดหนุน'
            ],
            '32': [
                'ครัวเรือนยากจนบางรายไม่ทราบข้อมูลหรือขั้นตอนการลงทะเบียนบัตรสวัสดิการแห่งรัฐ',
                'ปัญหาความล่าช้าหรือขาดการอัปเดตข้อมูลครัวเรือน ทำให้ไม่ได้รับสิทธิตามคุณสมบัติจริง',
                'ครัวเรือนไม่สามารถใช้สิทธิได้เต็มประโยชน์ เช่น ไม่รู้วิธีใช้บัตร หรือร้านค้าที่ร่วมรายการมีจำนวนน้อยในพื้นที่'
            ],
            '33': [
                'ขาดข้อมูลและการเข้าถึงระบบคุ้มครองทางสังคม เช่น ประกันสังคม กองทุนชราภาพ หรือกองทุนชุมชน',
                'กลไกในชุมชนยังไม่เข้มแข็งในการดูแลกลุ่มเปราะบาง เช่น เด็ก ผู้สูงอายุ หรือผู้พิการ',
                'ขาดการบูรณาการความช่วยเหลือระหว่างหน่วยงานรัฐและชุมชน'
            ],
            '34': [
                'ครอบครัวมีภาระงานมาก ทำให้ดูแลผู้สูงอายุได้ไม่ทั่วถึง',
                'ชุมชนยังขาดกิจกรรมหรือระบบอาสาสมัครดูแลผู้สูงอายุ (Care Giver / Care Taker)',
                'ผู้สูงอายุอาศัยอยู่ลำพัง ไม่มีเครือข่ายครอบครัวหรือผู้ดูแลใกล้ชิด'
            ],
            '35': [
                'ผู้พิการบางรายไม่ได้ขึ้นทะเบียนคนพิการ ทำให้ไม่ได้รับสิทธิและสวัสดิการตามกฎหมาย',
                'ครอบครัวขาดความรู้และทักษะในการดูแลหรือฟื้นฟูสมรรถภาพผู้พิการ',
                'สถานที่สาธารณะในชุมชนยังไม่เอื้อต่อการเข้าถึงของผู้พิการ เช่น ทางลาด ห้องน้ำ หรือระบบขนส่ง'
            ],
            '36': [
                'สมาชิกในครอบครัวขาดเวลาอยู่ร่วมกันเนื่องจากภาระงานหรือการย้ายถิ่นทำงานต่างพื้นที่',
                'มีปัญหาความรุนแรงในครอบครัวหรือการสื่อสารไม่เข้าใจกันระหว่างรุ่น',
                'ขาดกิจกรรมสร้างสัมพันธ์ในครอบครัวและชุมชนที่ส่งเสริมความรัก ความเข้าใจ'
            ],
            '38': [
                'ขาดจิตสำนึกสาธารณะหรือแรงจูงใจในการมีส่วนร่วมกับกิจกรรมของชุมชน',
                'ผู้นำหรือองค์กรชุมชนยังไม่มีกลไกเชิญชวนและสร้างการมีส่วนร่วมอย่างทั่วถึง',
                'ครัวเรือนบางส่วนอยู่ในพื้นที่ห่างไกล หรือมีภาระงานทำให้ไม่สามารถเข้าร่วมกิจกรรมได้'
            ]
        };

        let currentIndicatorId = null;
        let tempSelectedProblems = [];

        function toggleIndicator(card) {
            const id = card.dataset.id;
            const code = card.dataset.code;
            const title = card.querySelector('.indicator-title').textContent;
            const category = card.dataset.category;

            const index = selectedIndicators.findIndex(item => item.id === id);

            if (index > -1) {
                // Remove indicator
                selectedIndicators.splice(index, 1);
                card.classList.remove('selected');
                updateStats();
                updateSelectionPanel();
            } else {
                // Open modal to select problems
                currentIndicatorId = id;
                openProblemModal(id, code, title, category);
            }
        }

        function openProblemModal(id, code, title, category) {
            console.log('openProblemModal called with id:', id);
            const modal = document.getElementById('problemModal');
            const modalTitle = document.getElementById('modalIndicatorTitle');
            const problemsContainer = document.getElementById('modalProblemsContainer');

            // Set modal title
            modalTitle.textContent = `${id}. [${code}] ${title}`;

            // Get problems for this indicator
            const problems = indicatorProblems[id] || [];
            console.log('Problems for indicator', id, ':', problems);
            console.log('Number of problems:', problems.length);

            // Reset temp selection
            tempSelectedProblems = [];

            // Populate problems
            const problemsHTML = problems.map((problem, index) => `
                <div class="problem-option" onclick="toggleProblemSelection(${index})">
                    <div class="problem-checkbox">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="problem-text">${index + 1}. ${problem}</div>
                </div>
            `).join('');

            console.log('Generated HTML length:', problemsHTML.length);
            problemsContainer.innerHTML = problemsHTML;

            // Show modal
            modal.classList.add('show');
            console.log('Modal should now be visible');
        }

        function closeProblemModal() {
            const modal = document.getElementById('problemModal');
            modal.classList.remove('show');
            currentIndicatorId = null;
            tempSelectedProblems = [];
        }

        function toggleProblemSelection(index) {
            const problemOptions = document.querySelectorAll('.problem-option');
            const option = problemOptions[index];

            if (option.classList.contains('selected')) {
                option.classList.remove('selected');
                tempSelectedProblems = tempSelectedProblems.filter(i => i !== index);
            } else {
                option.classList.add('selected');
                tempSelectedProblems.push(index);
            }
        }

        function confirmProblemSelection() {
            if (tempSelectedProblems.length === 0) {
                showToast('กรุณาเลือกปัญหาอย่างน้อย 1 รายการ');
                return;
            }

            // Find the indicator card
            const card = document.querySelector(`.indicator-card[data-id="${currentIndicatorId}"]`);
            const code = card.dataset.code;
            const title = card.querySelector('.indicator-title').textContent;
            const category = card.dataset.category;

            // Get selected problem texts
            const problems = indicatorProblems[currentIndicatorId];
            const selectedProblemTexts = tempSelectedProblems
                .sort((a, b) => a - b)
                .map(index => problems[index]);

            // Add to selected indicators with problems
            selectedIndicators.push({
                id: currentIndicatorId,
                code,
                title,
                category,
                problems: selectedProblemTexts
            });

            // Update UI
            card.classList.add('selected');
            updateStats();
            updateSelectionPanel();

            // Close modal
            closeProblemModal();

            // Show success message
            showToast(`เลือกตัวชี้วัด #${currentIndicatorId} พร้อมปัญหา ${tempSelectedProblems.length} รายการ`);
        }

        function updateStats() {
            document.getElementById('selectedCount').textContent = selectedIndicators.length;
        }

        function updateSelectionPanel() {
            const panelContent = document.getElementById('panelContent');

            if (selectedIndicators.length === 0) {
                panelContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>ยังไม่มีรายการที่เลือก<br>คลิกที่ตัวชี้วัดเพื่อเลือก</p>
                    </div>
                `;
            } else {
                const sortedItems = [...selectedIndicators].sort((a, b) => parseInt(a.id) - parseInt(b.id));
                panelContent.innerHTML = sortedItems.map(item => `
                    <div class="selected-item">
                        <div class="selected-item-number">${item.id}</div>
                        <div class="selected-item-text">
                            <strong>[${item.code}]</strong> ${item.title}
                        </div>
                    </div>
                `).join('');
            }
        }

        function toggleSelectionPanel() {
            document.getElementById('selectionPanel').classList.toggle('show');
        }

        function clearSelection() {
            if (selectedIndicators.length === 0) {
                showToast('ไม่มีรายการที่จะลบ');
                return;
            }

            if (confirm(`ต้องการล้างการเลือกทั้งหมด ${selectedIndicators.length} รายการหรือไม่?`)) {
                selectedIndicators = [];
                document.querySelectorAll('.indicator-card.selected').forEach(card => {
                    card.classList.remove('selected');
                });
                updateStats();
                updateSelectionPanel();
                showToast('ล้างการเลือกสำเร็จ');
            }
        }

        // Generate output text (for display in output section)
        function generateOutput() {
            if (selectedIndicators.length === 0) {
                showToast('กรุณาเลือกตัวชี้วัดอย่างน้อย 1 รายการ');
                return;
            }

            const sortedItems = [...selectedIndicators].sort((a, b) => parseInt(a.id) - parseInt(b.id));

            let output = `รายการตัวชี้วัดและปัญหาที่เลือก (${selectedIndicators.length} รายการ)\n`;
            output += `${'='.repeat(80)}\n\n`;

            sortedItems.forEach((item, idx) => {
                output += `${idx + 1}. [${item.code}] ${item.title}\n`;
                output += `   หมวดหมู่: ${item.category}\n`;

                if (item.problems && item.problems.length > 0) {
                    output += `   ปัญหาที่เกี่ยวข้อง:\n`;
                    item.problems.forEach((problem, pIdx) => {
                        output += `   ${pIdx + 1}. ${problem}\n`;
                    });
                }
                output += `\n`;
            });

            output += `${'-'.repeat(80)}\n`;
            output += `สร้างโดย: ระบบ TPMAP Indicators Selector\n`;
            output += `วันที่: ${new Date().toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            })}\n`;
            output += `${'='.repeat(80)}\n`;

            // Show output section
            const outputSection = document.getElementById('outputSection');
            const outputContent = document.getElementById('outputContent');

            outputContent.textContent = output;
            outputSection.classList.add('show');

            // Scroll to output
            outputSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            showToast('สร้างข้อความสำเร็จ!');
        }

        // Copy output content to clipboard
        function copyOutputToClipboard() {
            const outputContent = document.getElementById('outputContent');
            const text = outputContent.textContent;

            if (!text || text.trim() === '') {
                showToast('ยังไม่มีข้อความที่จะคัดลอก กรุณากดปุ่ม "สร้างข้อความ" ก่อน');
                return;
            }

            // Try modern Clipboard API first (HTTPS)
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showSuccessTooltip('คัดลอกข้อความสำเร็จ!');
                }).catch(err => {
                    console.error('Clipboard API failed:', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                // Fallback for HTTP
                fallbackCopyToClipboard(text);
            }
        }

        // Reset all selections and hide output
        function resetSelection() {
            if (selectedIndicators.length === 0) {
                showToast('ไม่มีรายการที่จะลบ');
                return;
            }

            if (confirm(`ต้องการล้างข้อมูลทั้งหมดหรือไม่?`)) {
                // Clear selections
                selectedIndicators = [];
                document.querySelectorAll('.indicator-card.selected').forEach(card => {
                    card.classList.remove('selected');
                });

                // Hide output section
                const outputSection = document.getElementById('outputSection');
                const outputContent = document.getElementById('outputContent');
                outputSection.classList.remove('show');
                outputContent.textContent = '';

                // Update UI
                updateStats();
                updateSelectionPanel();

                showToast('ล้างข้อมูลสำเร็จ');
            }
        }

        function exportSelection() {
            if (selectedIndicators.length === 0) {
                showToast('กรุณาเลือกตัวชี้วัดอย่างน้อย 1 รายการ');
                return;
            }

            const sortedItems = [...selectedIndicators].sort((a, b) => parseInt(a.id) - parseInt(b.id));

            let output = `รายการตัวชี้วัดและปัญหาที่เลือก (${selectedIndicators.length} รายการ)\n`;
            output += `${'='.repeat(80)}\n\n`;

            sortedItems.forEach((item, idx) => {
                output += `${idx + 1}. [${item.code}] ${item.title}\n`;
                output += `   หมวดหมู่: ${item.category}\n`;

                if (item.problems && item.problems.length > 0) {
                    output += `   ปัญหาที่เกี่ยวข้อง:\n`;
                    item.problems.forEach((problem, pIdx) => {
                        output += `   ${pIdx + 1}. ${problem}\n`;
                    });
                }
                output += `\n`;
            });

            output += `${'-'.repeat(80)}\n`;
            output += `สร้างโดย: ระบบ TPMAP Indicators Selector\n`;
            output += `วันที่: ${new Date().toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            })}\n`;
            output += `${'='.repeat(80)}\n`;

            // Copy to clipboard with fallback for HTTP
            copyToClipboard(output);

            // Also download as file
            const blob = new Blob([output], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TPMAP_Indicators_Problems_${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Clipboard helper with HTTP/HTTPS fallback
        function copyToClipboard(text) {
            // Try modern Clipboard API first (HTTPS)
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showSuccessTooltip(`คัดลอก ${selectedIndicators.length} รายการสำเร็จ!`);
                }).catch(err => {
                    console.error('Clipboard API failed:', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                // Fallback for HTTP or older browsers
                fallbackCopyToClipboard(text);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';
            textArea.style.opacity = '0';

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showSuccessTooltip(`คัดลอก ${selectedIndicators.length} รายการสำเร็จ!`);
                } else {
                    showToast('❌ ไม่สามารถคัดลอกได้ กรุณาคัดลอกด้วยมือ (Ctrl+C)');
                }
            } catch (err) {
                console.error('Fallback copy failed:', err);
                showToast('❌ เกิดข้อผิดพลาดในการคัดลอก');
            }

            document.body.removeChild(textArea);
        }

        function showSuccessTooltip(message) {
            const tooltip = document.getElementById('successTooltip');
            const span = tooltip.querySelector('span');
            span.textContent = message;
            tooltip.classList.add('show');
            setTimeout(() => {
                tooltip.classList.remove('show');
            }, 3000);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize
        updateStats();
    </script>
</body>
</html>
