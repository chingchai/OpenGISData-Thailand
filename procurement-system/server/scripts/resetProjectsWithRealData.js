#!/usr/bin/env node
/**
 * Reset Projects with Real Data
 * Deletes all sample projects and adds real projects from ‡∏ú‡∏î.02 form
 */

import Database from 'better-sqlite3';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const DB_PATH = process.env.DB_PATH || path.join(__dirname, '../data/procurement.db');

console.log('üîÑ Resetting projects with real data from ‡∏ú‡∏î.02...\n');

const db = new Database(DB_PATH);

try {
  // Start transaction
  db.exec('BEGIN TRANSACTION');

  // 1. Delete all existing project steps
  console.log('   üóëÔ∏è  Deleting existing project steps...');
  const deleteSteps = db.prepare('DELETE FROM project_steps');
  const stepsDeleted = deleteSteps.run();
  console.log(`   ‚úì Deleted ${stepsDeleted.changes} project steps`);

  // 2. Delete all existing projects
  console.log('   üóëÔ∏è  Deleting existing projects...');
  const deleteProjects = db.prepare('DELETE FROM projects');
  const projectsDeleted = deleteProjects.run();
  console.log(`   ‚úì Deleted ${projectsDeleted.changes} projects`);

  // 3. Insert real projects from ‡∏ú‡∏î.02
  console.log('   ‚úÖ Inserting real projects from ‡∏ú‡∏î.02...');

  const projectStmt = db.prepare(`
    INSERT INTO projects (
      project_code, name, description, department_id,
      procurement_method, budget, start_date, expected_end_date,
      status, urgency_level, contractor_type, created_by
    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
  `);

  const projects = [
    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 1: ‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏¢‡∏≤‡∏¢‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏≤‡∏á‡∏ñ‡∏ô‡∏ô (‡∏Å‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á)
    [
      'PR-2568-002-001',
      '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏¢‡∏≤‡∏¢‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏≤‡∏á‡∏ñ‡∏ô‡∏ô ‡∏Ñ.‡∏™.‡∏•. ‡∏Ç‡πâ‡∏≤‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏• ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 1',
      '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏¢‡∏≤‡∏¢‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏≤‡∏á‡∏ñ‡∏ô‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 4.00 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏¢‡∏≤‡∏ß 80.00 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏´‡∏ô‡∏≤ 0.15 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 320 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏°‡∏ï‡∏£ ‡∏ï‡∏≥‡∏ö‡∏•‡∏´‡∏±‡∏ß‡∏ó‡∏∞‡πÄ‡∏• ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 1',
      2, // ‡∏Å‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á
      'specific', // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á
      224000.00,
      '2025-01-01', // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568
      '2025-03-31', // ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2568
      'in_progress', // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
      'normal',
      'construction',
      2 // created by staff_engineering
    ],

    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 3: ‡∏ß‡∏≤‡∏á‡∏ó‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ (‡∏Å‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á - ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏ä‡∏¥‡∏ç‡∏ä‡∏ß‡∏ô)
    [
      'PR-2568-002-002',
      '‡∏ß‡∏≤‡∏á‡∏ó‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ ‡∏Ñ.‡∏™.‡∏•. ‡∏°‡∏≠‡∏Å.‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏à‡∏≤‡∏Å‡∏õ‡∏≤‡∏Å‡∏ã‡∏≠‡∏¢‡πÄ‡∏û‡∏ä‡∏£‡∏°‡∏≤‡∏ï‡∏∏‡∏Ñ‡∏•‡∏≤ 16 ‡∏ñ‡∏∂‡∏á‡∏õ‡∏≤‡∏Å‡∏ã‡∏≠‡∏¢‡πÄ‡∏û‡∏ä‡∏£‡∏°‡∏≤‡∏ï‡∏∏‡∏Ñ‡∏•‡∏≤ 14',
      '‡∏ß‡∏≤‡∏á‡∏ó‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å ‡∏°‡∏≠‡∏Å. ‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡πà‡∏≤‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á 1.20 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 104 ‡∏ó‡πà‡∏≠‡∏ô ‡∏ö‡πà‡∏≠‡∏û‡∏±‡∏Å 11 ‡∏ö‡πà‡∏≠ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏ß‡∏° 115.00 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 2 ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 3 ‡∏ï‡∏≥‡∏ö‡∏•‡∏´‡∏±‡∏ß‡∏ó‡∏∞‡πÄ‡∏•',
      2, // ‡∏Å‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á
      'public_invitation', // ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏ä‡∏¥‡∏ç‡∏ä‡∏ß‡∏ô
      1500000.00,
      '2024-11-01', // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2567
      '2025-02-28', // ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2568
      'in_progress', // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
      'urgent',
      'construction',
      2 // created by staff_engineering
    ],

    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 8: ‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏Ñ‡∏£‡∏π‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥ (‡∏Å‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ - ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
    [
      'PR-2568-003-001',
      '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏Ñ‡∏£‡∏π‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥‡∏™‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥',
      '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏Ñ‡∏£‡∏π‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥‡∏™‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. 2568 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å‡πÉ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î',
      3, // ‡∏Å‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
      'selection', // ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      300000.00,
      '2025-05-01', // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏° 2568
      '2025-09-30', // ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2568
      'draft', // ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
      'normal',
      'services',
      3 // created by staff_education
    ]
  ];

  for (const project of projects) {
    projectStmt.run(...project);
  }

  console.log(`   ‚úì Inserted ${projects.length} real projects`);

  // Commit transaction
  db.exec('COMMIT');

  console.log('\n‚úÖ Projects reset successfully!');
  console.log('\nüìä New Projects Summary:');
  console.log('   1. ‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏¢‡∏≤‡∏¢‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏≤‡∏á‡∏ñ‡∏ô‡∏ô - 224,000 ‡∏ö‡∏≤‡∏ó (‡∏Å‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á)');
  console.log('   2. ‡∏ß‡∏≤‡∏á‡∏ó‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ - 1,500,000 ‡∏ö‡∏≤‡∏ó (‡∏Å‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á - ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏ä‡∏¥‡∏ç‡∏ä‡∏ß‡∏ô)');
  console.log('   3. ‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏Ñ‡∏£‡∏π‡∏ï‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥ - 300,000 ‡∏ö‡∏≤‡∏ó (‡∏Å‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ - ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)');
  console.log('   Total Budget: 2,024,000 ‡∏ö‡∏≤‡∏ó');

} catch (error) {
  // Rollback on error
  db.exec('ROLLBACK');
  console.error('\n‚ùå Error resetting projects:', error);
  process.exit(1);
} finally {
  db.close();
  console.log('\n‚úì Database connection closed');
  process.exit(0);
}
