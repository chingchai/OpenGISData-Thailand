# à¸£à¸°à¸šà¸šà¸à¸³à¸à¸±à¸šà¸•à¸´à¸”à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸à¹‰à¸²à¸§à¸«à¸™à¹‰à¸²à¹‚à¸„à¸£à¸‡à¸à¸²à¸£ - à¸„à¸¹à¹ˆà¸¡à¸·à¸­ Deployment à¸‰à¸šà¸±à¸šà¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ

## ğŸ“‹ à¸ªà¸²à¸£à¸šà¸±à¸

1. [à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š](#à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š)
2. [à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¸£à¸°à¸šà¸š](#à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¸£à¸°à¸šà¸š)
3. [à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰](#à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰)
4. [à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸”à¹€à¸£à¸à¸—à¸­à¸£à¸µ](#à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸”à¹€à¸£à¸à¸—à¸­à¸£à¸µ)
5. [à¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”à¸‚à¸­à¸‡ Server](#à¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”à¸‚à¸­à¸‡-server)
6. [à¸à¸²à¸£ Deploy à¹à¸šà¸š Subdirectory](#à¸à¸²à¸£-deploy-à¹à¸šà¸š-subdirectory)
7. [à¹„à¸Ÿà¸¥à¹Œ Configuration à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸](#à¹„à¸Ÿà¸¥à¹Œ-configuration-à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸)
8. [à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡](#à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡)
9. [à¸à¸²à¸£à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆà¸à¸šà¸šà¹ˆà¸­à¸¢](#à¸à¸²à¸£à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆà¸à¸šà¸šà¹ˆà¸­à¸¢)
10. [à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸šà¸³à¸£à¸¸à¸‡à¸£à¸±à¸à¸©à¸²](#à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸šà¸³à¸£à¸¸à¸‡à¸£à¸±à¸à¸©à¸²)

---

## à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š

### à¸Šà¸·à¹ˆà¸­à¸£à¸°à¸šà¸š
**à¸£à¸°à¸šà¸šà¸à¸³à¸à¸±à¸šà¸•à¸´à¸”à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸à¹‰à¸²à¸§à¸«à¸™à¹‰à¸²à¹‚à¸„à¸£à¸‡à¸à¸²à¸£** (Procurement System)

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ
à¸£à¸°à¸šà¸šà¸ªà¸³à¸«à¸£à¸±à¸šà¸•à¸´à¸”à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸à¹‰à¸²à¸§à¸«à¸™à¹‰à¸²à¸‚à¸­à¸‡à¹‚à¸„à¸£à¸‡à¸à¸²à¸£à¸ˆà¸±à¸”à¸‹à¸·à¹‰à¸­à¸ˆà¸±à¸”à¸ˆà¹‰à¸²à¸‡à¸‚à¸­à¸‡à¹€à¸—à¸¨à¸šà¸²à¸¥à¸•à¸³à¸šà¸¥à¸«à¸±à¸§à¸—à¸°à¹€à¸¥

### URL à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡
- **Production:** http://49.231.27.66/procurement/
- **Alternative:** http://202.29.4.66/procurement/
- **API Endpoint:** http://49.231.27.66/procurement/api/

### à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸„à¸±à¸
- à¸£à¸°à¸šà¸šà¸–à¸¹à¸ deploy à¸—à¸µà¹ˆ **subdirectory** `/procurement/` **à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ root path**
- à¸£à¸°à¸šà¸šà¸•à¹‰à¸­à¸‡à¸­à¸¢à¸¹à¹ˆà¸£à¹ˆà¸§à¸¡à¸à¸±à¸š applications à¸­à¸·à¹ˆà¸™à¸šà¸™ server à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™
- à¹ƒà¸Šà¹‰ Nginx à¹€à¸›à¹‡à¸™ reverse proxy à¸ªà¸³à¸«à¸£à¸±à¸š frontend à¹à¸¥à¸° API

---

## à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¸£à¸°à¸šà¸š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Internet                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Production Server (49.231.27.66)                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Nginx (Port 80)                      â”‚  â”‚
â”‚  â”‚              root /var/www/html                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                 â”‚                        â”‚                    â”‚
â”‚                 â–¼                        â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Static Files       â”‚  â”‚    API Proxy               â”‚   â”‚
â”‚  â”‚   /procurement/      â”‚  â”‚    /procurement/api/       â”‚   â”‚
â”‚  â”‚   (Symlink)          â”‚  â”‚    â†’ localhost:3000        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                            â”‚                    â”‚
â”‚             â–¼                            â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ /var/www/html/       â”‚  â”‚   PM2 Process Manager      â”‚   â”‚
â”‚  â”‚ procurement          â”‚  â”‚   (Port 3000)              â”‚   â”‚
â”‚  â”‚     â†“ (symlink)      â”‚  â”‚                            â”‚   â”‚
â”‚  â”‚ /var/www/            â”‚  â”‚   Express.js Backend       â”‚   â”‚
â”‚  â”‚ OpenGISData-Thailand/â”‚  â”‚                            â”‚   â”‚
â”‚  â”‚ procurement-system/  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚ client/dist/         â”‚  â”‚   â”‚  SQLite Database â”‚    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  (procurement.db)â”‚    â”‚   â”‚
â”‚                             â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™

1. **User à¹€à¸‚à¹‰à¸² `/procurement/`**
   - Nginx serve static files à¸ˆà¸²à¸ symlink â†’ dist folder
   - React SPA à¹‚à¸«à¸¥à¸”à¹à¸¥à¸°à¸ˆà¸±à¸”à¸à¸²à¸£ client-side routing à¸”à¹‰à¸§à¸¢ React Router

2. **User à¸—à¸³ API call**
   - Frontend à¹€à¸£à¸µà¸¢à¸ `/procurement/api/*`
   - Nginx proxy_pass à¹„à¸›à¸—à¸µà¹ˆ `http://localhost:3000/api/*`
   - Express.js backend à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¹à¸¥à¸°à¸•à¸­à¸šà¸à¸¥à¸±à¸š
   - Backend à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ SQLite database

3. **React Router Handling**
   - Router à¸¡à¸µ `basename="/procurement"`
   - à¸—à¸¸à¸ route à¸ˆà¸°à¸–à¸¹à¸à¹€à¸•à¸´à¸¡ `/procurement` prefix à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
   - à¹€à¸Šà¹ˆà¸™ `/dashboard` à¸ˆà¸°à¸à¸¥à¸²à¸¢à¹€à¸›à¹‡à¸™ `/procurement/dashboard`

---

## à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰

### Frontend
- **Framework:** React 18.3.1
- **Build Tool:** Vite 7.2.4
- **Router:** React Router DOM 7.1.1
- **Styling:** Tailwind CSS 4.0.0
- **HTTP Client:** Axios 1.7.9
- **Icons:** Font Awesome
- **State Management:** React Context API
- **Map:** Leaflet.js (à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸ªà¸”à¸‡à¹à¸œà¸™à¸—à¸µà¹ˆà¹‚à¸„à¸£à¸‡à¸à¸²à¸£)

### Backend
- **Runtime:** Node.js 20.x
- **Framework:** Express.js 4.21.2
- **Database:** SQLite 3 (sqlite3 npm package 5.1.7)
- **Authentication:** JWT (jsonwebtoken 9.0.2)
- **Password Hashing:** bcrypt 5.1.1
- **Process Manager:** PM2 (à¹ƒà¸Šà¹‰à¸£à¸±à¸™ backend à¹ƒà¸™ production)
- **Validation:** express-validator 7.2.1
- **CORS:** cors 2.8.5
- **Logging:** Winston 3.17.0

### Server & Infrastructure
- **OS:** Ubuntu (Linux)
- **Web Server:** Nginx 1.24.0
- **Process Manager:** PM2 6.0.10
- **Git:** Version control
- **Node.js:** v20.x (à¸ˆà¸²à¸ NodeSource repository)

### Development Tools
- **Package Manager:** npm
- **Version Control:** Git

---

## à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸”à¹€à¸£à¸à¸—à¸­à¸£à¸µ

```
/var/www/OpenGISData-Thailand/
â””â”€â”€ procurement-system/
    â”œâ”€â”€ client/                          # Frontend (React)
    â”‚   â”œâ”€â”€ src/
    â”‚   â”‚   â”œâ”€â”€ components/              # React components
    â”‚   â”‚   â”œâ”€â”€ contexts/                # Context API (AuthContext)
    â”‚   â”‚   â”œâ”€â”€ pages/                   # Page components
    â”‚   â”‚   â”‚   â”œâ”€â”€ LoginPage.jsx        # à¸«à¸™à¹‰à¸² Login
    â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardPage.jsx    # Dashboard
    â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectsPage.jsx     # à¸£à¸²à¸¢à¸à¸²à¸£à¹‚à¸„à¸£à¸‡à¸à¸²à¸£
    â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectDetailPage.jsx
    â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectMapDashboard.jsx
    â”‚   â”‚   â”‚   â”œâ”€â”€ OverduePage.jsx
    â”‚   â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”‚   â”œâ”€â”€ services/
    â”‚   â”‚   â”‚   â””â”€â”€ api.js               # âš ï¸ à¸ªà¸³à¸„à¸±à¸: API_URL = '/procurement/api'
    â”‚   â”‚   â”œâ”€â”€ App.jsx                  # âš ï¸ à¸ªà¸³à¸„à¸±à¸: <Router basename="/procurement">
    â”‚   â”‚   â””â”€â”€ main.jsx
    â”‚   â”œâ”€â”€ public/
    â”‚   â”œâ”€â”€ dist/                        # Build output (à¸«à¸¥à¸±à¸‡ npm run build)
    â”‚   â”‚   â”œâ”€â”€ index.html
    â”‚   â”‚   â”œâ”€â”€ assets/
    â”‚   â”‚   â”‚   â”œâ”€â”€ index-*.js
    â”‚   â”‚   â”‚   â””â”€â”€ index-*.css
    â”‚   â”‚   â””â”€â”€ clear-storage.html
    â”‚   â”œâ”€â”€ package.json
    â”‚   â”œâ”€â”€ vite.config.js               # âš ï¸ à¸ªà¸³à¸„à¸±à¸: base: '/procurement'
    â”‚   â””â”€â”€ tailwind.config.js
    â”‚
    â”œâ”€â”€ server/                          # Backend (Express.js)
    â”‚   â”œâ”€â”€ controllers/
    â”‚   â”‚   â”œâ”€â”€ authController.js        # Authentication logic
    â”‚   â”‚   â”œâ”€â”€ projectController.js
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”œâ”€â”€ middleware/
    â”‚   â”‚   â”œâ”€â”€ auth.js                  # JWT verification
    â”‚   â”‚   â””â”€â”€ validation.js            # Input validation
    â”‚   â”œâ”€â”€ routes/
    â”‚   â”‚   â”œâ”€â”€ auth.js                  # /api/auth/*
    â”‚   â”‚   â”œâ”€â”€ projects.js              # /api/projects/*
    â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”œâ”€â”€ data/
    â”‚   â”‚   â””â”€â”€ database/
    â”‚   â”‚       â”œâ”€â”€ procurement.db       # âš ï¸ à¸ªà¸³à¸„à¸±à¸: SQLite database file
    â”‚   â”‚       â”œâ”€â”€ schema.sql           # Database schema
    â”‚   â”‚       â””â”€â”€ seed.sql             # Initial data
    â”‚   â”œâ”€â”€ uploads/                     # à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆ upload
    â”‚   â”œâ”€â”€ server.js                    # âš ï¸ à¸ªà¸³à¸„à¸±à¸: Main entry point
    â”‚   â””â”€â”€ package.json
    â”‚
    â”œâ”€â”€ nginx.conf.production            # âš ï¸ à¸ªà¸³à¸„à¸±à¸: Nginx config template
    â”œâ”€â”€ clean-install.cjs                # Automated installation script
    â”œâ”€â”€ diagnose-nginx.cjs               # Diagnostic tool
    â”œâ”€â”€ DEPLOYMENT_GUIDE.md              # à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰
    â”œâ”€â”€ DEPLOYMENT_SUCCESS.md            # Deployment summary
    â””â”€â”€ README.md

/var/www/html/
â””â”€â”€ procurement â†’ /var/www/OpenGISData-Thailand/procurement-system/client/dist/
    # âš ï¸ à¸ªà¸³à¸„à¸±à¸: Symlink à¸ªà¸³à¸«à¸£à¸±à¸šà¹ƒà¸«à¹‰ Nginx serve à¹„à¸Ÿà¸¥à¹Œ static

/etc/nginx/sites-available/
â””â”€â”€ default                             # âš ï¸ à¸ªà¸³à¸„à¸±à¸: Nginx configuration
```

---

## à¸‚à¹‰à¸­à¸à¸³à¸«à¸™à¸”à¸‚à¸­à¸‡ Server

### Software Requirements

```bash
# 1. Node.js 20.x
node --version  # v20.x.x

# 2. npm
npm --version   # 10.x.x

# 3. PM2
pm2 --version   # 6.x.x

# 4. Nginx
nginx -v        # nginx/1.24.0

# 5. SQLite3 (CLI tool)
sqlite3 --version  # 3.45.x

# 6. Git
git --version   # 2.x.x
```

### System Requirements
- **OS:** Ubuntu 20.04+ (à¸«à¸£à¸·à¸­ Linux distribution à¸­à¸·à¹ˆà¸™à¸—à¸µà¹ˆà¸£à¸­à¸‡à¸£à¸±à¸š Node.js)
- **RAM:** à¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³ 1GB (à¹à¸™à¸°à¸™à¸³ 2GB+)
- **Disk Space:** à¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³ 2GB (à¸ªà¸³à¸«à¸£à¸±à¸š code, dependencies, à¹à¸¥à¸° database)
- **Network:** Port 80 à¹€à¸›à¸´à¸”à¸ªà¸³à¸«à¸£à¸±à¸š HTTP traffic

### User Permissions
- Backend à¸„à¸§à¸£à¸£à¸±à¸™à¸”à¹‰à¸§à¸¢ user à¸—à¸µà¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œà¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ database file
- Frontend static files à¸•à¹‰à¸­à¸‡ readable à¹‚à¸”à¸¢ `www-data` (Nginx user)
- Nginx à¸•à¹‰à¸­à¸‡à¸ªà¸²à¸¡à¸²à¸£à¸– proxy à¹„à¸›à¸—à¸µà¹ˆ `localhost:3000`

---

## à¸à¸²à¸£ Deploy à¹à¸šà¸š Subdirectory

### âš ï¸ à¸ªà¸´à¹ˆà¸‡à¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ

à¸£à¸°à¸šà¸šà¸™à¸µà¹‰ **à¹„à¸¡à¹ˆà¹„à¸”à¹‰ deploy à¸—à¸µà¹ˆ root path** (`/`) à¹à¸•à¹ˆ deploy à¸—à¸µà¹ˆ **subdirectory** (`/procurement/`)

à¸™à¸µà¹ˆà¸„à¸·à¸­à¸„à¸§à¸²à¸¡à¸—à¹‰à¸²à¸—à¸²à¸¢à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡à¸à¸²à¸£ deploy à¹à¸¥à¸°à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚à¹ƒà¸™à¸«à¸¥à¸²à¸¢à¸ˆà¸¸à¸”:

### 1. Frontend Configuration

#### **vite.config.js**
```javascript
export default defineConfig({
  plugins: [react()],
  base: '/procurement',  // âš ï¸ à¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸: à¸à¸³à¸«à¸™à¸” base path à¸ªà¸³à¸«à¸£à¸±à¸š assets
  server: {
    port: 3001,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      }
    }
  }
})
```

**à¹€à¸«à¸•à¸¸à¸œà¸¥:** Vite à¸•à¹‰à¸­à¸‡à¸£à¸¹à¹‰à¸§à¹ˆà¸² assets (CSS, JS) à¸ˆà¸°à¸–à¸¹à¸ serve à¸ˆà¸²à¸ `/procurement/assets/` à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ `/assets/`

#### **App.jsx**
```javascript
function App() {
  return (
    <AuthProvider>
      <Router basename="/procurement">  {/* âš ï¸ à¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸ */}
        <Routes>
          <Route path="/login" element={<LoginPage />} />
          <Route path="/dashboard" element={<ProtectedRoute><DashboardPage /></ProtectedRoute>} />
          {/* ... */}
        </Routes>
      </Router>
    </AuthProvider>
  );
}
```

**à¹€à¸«à¸•à¸¸à¸œà¸¥:** React Router à¸•à¹‰à¸­à¸‡à¸£à¸¹à¹‰à¸§à¹ˆà¸² base path à¸„à¸·à¸­ `/procurement` à¹€à¸à¸·à¹ˆà¸­à¸—à¸µà¹ˆà¸ˆà¸°:
- Render à¸–à¸¹à¸ route à¹€à¸¡à¸·à¹ˆà¸­ user à¹€à¸‚à¹‰à¸² `/procurement/dashboard`
- Navigate à¹„à¸›à¸¢à¸±à¸‡ `/procurement/login` à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸¡à¹ˆ authenticated
- Generate links à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

#### **services/api.js**
```javascript
const API_URL = '/procurement/api';  // âš ï¸ à¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸: à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ '/api'

// Response interceptor
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = '/procurement/login';  // âš ï¸ à¸•à¹‰à¸­à¸‡à¸¡à¸µ /procurement prefix
    }
    return Promise.reject(error);
  }
);
```

**à¹€à¸«à¸•à¸¸à¸œà¸¥:** API calls à¸•à¹‰à¸­à¸‡à¹„à¸›à¸—à¸µà¹ˆ `/procurement/api/*` à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ `/api/*`

### 2. Nginx Configuration

#### **Nginx Config Strategy: root + symlink**

à¹€à¸£à¸²à¹ƒà¸Šà¹‰à¸§à¸´à¸˜à¸µ **root directive + symlink** à¹à¸—à¸™ **alias directive** à¹€à¸à¸£à¸²à¸°:
- `alias` à¸¡à¸µà¸›à¸±à¸à¸«à¸²à¸à¸±à¸š `try_files` fallback à¹ƒà¸™ subdirectory
- `root` + symlink à¸—à¸³à¹ƒà¸«à¹‰ path resolution à¸—à¸³à¸‡à¸²à¸™à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

```nginx
server {
    listen 80 default_server;
    server_name 202.29.4.66 49.231.27.66 _;

    root /var/www/html;  # âš ï¸ à¹ƒà¸Šà¹‰ root, à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ alias

    # API Proxy
    location ^~ /procurement/api/ {
        proxy_pass http://localhost:3000/api/;  # âš ï¸ remove /procurement prefix
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Frontend static files
    location /procurement/ {
        try_files $uri $uri/ /procurement/index.html;  # âš ï¸ fallback à¸•à¹‰à¸­à¸‡à¸£à¸°à¸šà¸¸ full path
    }

    # Redirect /procurement to /procurement/
    location = /procurement {
        return 301 /procurement/;
    }

    # Other applications
    location / {
        try_files $uri $uri/ =404;
    }
}
```

#### **Symlink Setup**
```bash
# à¸ªà¸£à¹‰à¸²à¸‡ symlink
ln -sf /var/www/OpenGISData-Thailand/procurement-system/client/dist /var/www/html/procurement

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š
ls -la /var/www/html/procurement
# lrwxrwxrwx 1 root root 60 Nov 24 03:53 /var/www/html/procurement -> /var/www/OpenGISData-Thailand/procurement-system/client/dist
```

**à¹€à¸«à¸•à¸¸à¸œà¸¥:**
- Nginx `root /var/www/html` + `location /procurement/` à¸ˆà¸°à¸«à¸²à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆ `/var/www/html/procurement/`
- Symlink à¸—à¸³à¹ƒà¸«à¹‰ Nginx à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ dist folder à¹„à¸”à¹‰à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡ copy files
- à¹€à¸¡à¸·à¹ˆà¸­ rebuild frontend, à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸¡à¹ˆà¸ˆà¸°à¸–à¸¹à¸ serve à¸—à¸±à¸™à¸—à¸µà¸œà¹ˆà¸²à¸™ symlink

### 3. Backend Configuration

Backend **à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸£à¸¹à¹‰** à¹€à¸£à¸·à¹ˆà¸­à¸‡ `/procurement` prefix à¹€à¸à¸£à¸²à¸°:
- Nginx strip prefix à¸­à¸­à¸à¸à¹ˆà¸­à¸™ proxy
- Request à¸ˆà¸²à¸ `/procurement/api/auth/login` à¸ˆà¸°à¸–à¸¹à¸ proxy à¹€à¸›à¹‡à¸™ `http://localhost:3000/api/auth/login`
- Backend à¹€à¸«à¹‡à¸™à¹à¸„à¹ˆ `/api/auth/login`

```javascript
// server.js
app.use('/api/auth', authRoutes);       // Backend route: /api/auth
app.use('/api/projects', projectRoutes); // Backend route: /api/projects
// ...

// Nginx à¸ˆà¸°à¹à¸›à¸¥à¸‡:
// /procurement/api/auth/login â†’ proxy_pass â†’ http://localhost:3000/api/auth/login
```

---

## à¹„à¸Ÿà¸¥à¹Œ Configuration à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸

### 1. `/var/www/OpenGISData-Thailand/procurement-system/client/vite.config.js`

```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  base: '/procurement',  // âš ï¸ CRITICAL: à¸«à¹‰à¸²à¸¡à¸¥à¸·à¸¡!
  server: {
    port: 3001,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      }
    }
  }
})
```

### 2. `/var/www/OpenGISData-Thailand/procurement-system/client/src/services/api.js`

```javascript
import axios from 'axios';

const API_URL = '/procurement/api';  // âš ï¸ CRITICAL: à¸•à¹‰à¸­à¸‡à¸¡à¸µ /procurement prefix

const api = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.href = '/procurement/login';  // âš ï¸ CRITICAL: à¸¡à¸µ /procurement prefix
    }
    return Promise.reject(error);
  }
);

export const authAPI = {
  login: (username, password, role) =>
    api.post('/auth/login', { username, password, role }),
  // ...
};
```

### 3. `/var/www/OpenGISData-Thailand/procurement-system/client/src/App.jsx`

```javascript
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider, useAuth } from './contexts/AuthContext';

function App() {
  return (
    <AuthProvider>
      <Router basename="/procurement">  {/* âš ï¸ CRITICAL: basename */}
        <Routes>
          <Route path="/login" element={<LoginPage />} />
          <Route path="/dashboard" element={
            <ProtectedRoute><DashboardPage /></ProtectedRoute>
          } />
          {/* ... other routes ... */}
        </Routes>
      </Router>
    </AuthProvider>
  );
}
```

### 4. `/var/www/OpenGISData-Thailand/procurement-system/server/server.js`

```javascript
import express from 'express';
import cors from 'cors';
import path from 'path';
import { fileURLToPath } from 'url';
import { initializeDatabase } from './config/database.js';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(cors({
  origin: ['http://localhost:5173', 'http://localhost:3001'],
  credentials: true
}));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Serve uploaded files
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));

// Routes - âš ï¸ à¸ªà¸±à¸‡à¹€à¸à¸•à¸§à¹ˆà¸² backend routes à¹„à¸¡à¹ˆà¸¡à¸µ /procurement prefix
app.use('/api/auth', authRoutes);
app.use('/api/projects', projectRoutes);
app.use('/api/departments', departmentsRoutes);
// ... other routes ...

// Health check
app.get('/api/', (req, res) => {
  res.json({
    success: true,
    message: 'à¸£à¸°à¸šà¸šà¸à¸³à¸à¸±à¸šà¸•à¸´à¸”à¸•à¸²à¸¡à¸„à¸§à¸²à¸¡à¸à¹‰à¸²à¸§à¸«à¸™à¹‰à¸²à¹‚à¸„à¸£à¸‡à¸à¸²à¸£ API',
    version: '1.0.0',
    endpoints: {
      auth: '/api/auth',
      projects: '/api/projects',
      // ...
    }
  });
});

// Initialize database and start server
async function startServer() {
  try {
    await initializeDatabase();
    app.listen(PORT, () => {
      console.log(`âœ… Server is ready!`);
    });
  } catch (error) {
    console.error('Failed to start server:', error);
    process.exit(1);
  }
}

startServer();
```

### 5. `/etc/nginx/sites-available/default`

```nginx
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name 202.29.4.66 49.231.27.66 _;

    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;

    # API Proxy to Backend
    location ^~ /procurement/api/ {
        proxy_pass http://localhost:3000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Serve procurement frontend (using symlink)
    # Requires: ln -sf /var/www/OpenGISData-Thailand/procurement-system/client/dist /var/www/html/procurement
    location /procurement/ {
        try_files $uri $uri/ /procurement/index.html;
    }

    # Redirect /procurement to /procurement/
    location = /procurement {
        return 301 /procurement/;
    }

    # Default location for other applications
    location / {
        try_files $uri $uri/ =404;
    }
}
```

### 6. `/var/www/OpenGISData-Thailand/procurement-system/server/middleware/validation.js`

```javascript
import { body } from 'express-validator';

// âš ï¸ à¸ªà¸³à¸„à¸±à¸: Login validation requires 'role' field
export const validateLogin = [
  body('username')
    .trim()
    .notEmpty().withMessage('Username is required')
    .isLength({ min: 3, max: 50 }),

  body('password')
    .notEmpty().withMessage('Password is required')
    .isLength({ min: 8 }).withMessage('Password must be at least 8 characters'),

  body('role')
    .notEmpty().withMessage('User type is required')
    .isIn(['staff', 'admin', 'executive']).withMessage('Invalid user type'),

  handleValidationErrors
];
```

---

## à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡

### à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 1: Clean Install (Automated)

à¹ƒà¸Šà¹‰ script à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸ªà¸³à¸«à¸£à¸±à¸šà¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¹ƒà¸«à¸¡à¹ˆà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”:

```bash
# 1. Clone repository
cd /tmp
git clone https://github.com/bogarb12/OpenGISData-Thailand.git
cd OpenGISData-Thailand
git checkout claude/pull-opengis-thailand-setup-018ToN3x1p5eZ6HTy1q4VAAi

# 2. à¸£à¸±à¸™ clean installation script
sudo node procurement-system/clean-install.cjs
```

Script à¸ˆà¸°à¸—à¸³à¸ªà¸´à¹ˆà¸‡à¹€à¸«à¸¥à¹ˆà¸²à¸™à¸µà¹‰à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´:
1. âœ… à¸«à¸¢à¸¸à¸”à¹à¸¥à¸°à¸¥à¸š PM2 processes à¹€à¸”à¸´à¸¡
2. âœ… à¸¥à¸š Nginx configs à¹€à¸”à¸´à¸¡
3. âœ… à¸¥à¸š directories à¹€à¸”à¸´à¸¡
4. âœ… Clone repository à¹ƒà¸«à¸¡à¹ˆ
5. âœ… Build frontend
6. âœ… Install backend dependencies
7. âœ… Set permissions
8. âœ… Configure Nginx
9. âœ… Create symlink
10. âœ… Start PM2 backend
11. âœ… Test endpoints

### à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆ 2: Manual Installation

#### Step 1: Install Prerequisites

```bash
# Update system
sudo apt-get update

# Install Node.js 20.x (if not installed)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# Install PM2 globally
sudo npm install -g pm2

# Install Nginx (if not installed)
sudo apt-get install -y nginx

# Install SQLite3 CLI
sudo apt-get install -y sqlite3

# Install Git (if not installed)
sudo apt-get install -y git
```

#### Step 2: Clone Repository

```bash
# Create directory
sudo mkdir -p /var/www/OpenGISData-Thailand
cd /var/www/OpenGISData-Thailand

# Clone
sudo git clone https://github.com/bogarb12/OpenGISData-Thailand.git .
sudo git checkout claude/pull-opengis-thailand-setup-018ToN3x1p5eZ6HTy1q4VAAi
```

#### Step 3: Build Frontend

```bash
cd /var/www/OpenGISData-Thailand/procurement-system/client

# Install dependencies
npm install

# Build for production
npm run build

# Set permissions
sudo chmod -R 755 dist
```

#### Step 4: Setup Backend

```bash
cd /var/www/OpenGISData-Thailand/procurement-system/server

# Install dependencies
npm install

# Database à¸ˆà¸°à¸–à¸¹à¸ initialize à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹€à¸¡à¸·à¹ˆà¸­ start server
```

#### Step 5: Configure Nginx

```bash
# Backup existing config
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.backup

# Copy production config
sudo cp /var/www/OpenGISData-Thailand/procurement-system/nginx.conf.production /etc/nginx/sites-available/default

# Create symlink for frontend
sudo ln -sf /var/www/OpenGISData-Thailand/procurement-system/client/dist /var/www/html/procurement

# Test config
sudo nginx -t

# Reload Nginx
sudo systemctl reload nginx
```

#### Step 6: Start Backend with PM2

```bash
cd /var/www/OpenGISData-Thailand/procurement-system/server

# Start with PM2
pm2 start server.js --name procurement-backend

# Save PM2 config
pm2 save

# Setup PM2 startup (optional)
pm2 startup
# Follow the instructions provided
```

#### Step 7: Set Correct Passwords

```bash
cd /var/www/OpenGISData-Thailand/procurement-system/server

# Generate password hash for "password123"
node -e "const bcrypt = require('bcrypt'); bcrypt.hash('password123', 10, (err, hash) => { console.log(hash); });"

# Copy the output hash, then update all users
sqlite3 data/database/procurement.db "UPDATE users SET password = '\$2b\$10\$YOUR_HASH_HERE';"
```

#### Step 8: Test Installation

```bash
# Test frontend
curl -I http://localhost/procurement/login
# Expected: HTTP/1.1 200 OK, Content-Length: 1291

# Test API
curl http://localhost/procurement/api/
# Expected: JSON with success: true

# Test login
curl -X POST http://localhost/procurement/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password123","role":"admin"}'
# Expected: JSON with token
```

---

## à¸à¸²à¸£à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆà¸à¸šà¸šà¹ˆà¸­à¸¢

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 1: CSS/JS Assets 404

**à¸­à¸²à¸à¸²à¸£:** à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸šà¹‚à¸«à¸¥à¸”à¹„à¸”à¹‰à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¸¡à¸µ style, à¹„à¸Ÿà¸¥à¹Œ .css à¹à¸¥à¸° .js à¹„à¸¡à¹ˆà¹‚à¸«à¸¥à¸”

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- Permission à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
- Symlink à¹„à¸¡à¹ˆà¸¡à¸µà¸«à¸£à¸·à¸­à¸Šà¸µà¹‰à¸œà¸´à¸”
- Vite config à¹„à¸¡à¹ˆà¸¡à¸µ `base: '/procurement'`

**à¹à¸à¹‰à¹„à¸‚:**
```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š permission
chmod -R 755 /var/www/OpenGISData-Thailand/procurement-system/client/dist

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š symlink
ls -la /var/www/html/procurement
# à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ:
sudo ln -sf /var/www/OpenGISData-Thailand/procurement-system/client/dist /var/www/html/procurement

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š vite.config.js
grep "base:" /var/www/OpenGISData-Thailand/procurement-system/client/vite.config.js
# à¸•à¹‰à¸­à¸‡à¹€à¸«à¹‡à¸™: base: '/procurement'

# à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¹à¸à¹‰à¹„à¸‚à¹à¸¥à¹‰à¸§ rebuild
cd /var/www/OpenGISData-Thailand/procurement-system/client
npm run build
```

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 2: Login à¹„à¸¡à¹ˆà¹„à¸”à¹‰ - API Error

**à¸­à¸²à¸à¸²à¸£:** à¸à¸” login à¹à¸¥à¹‰à¸§à¹à¸ªà¸”à¸‡ "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š"

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- `api.js` à¸¡à¸µ API_URL = '/api' (à¹„à¸¡à¹ˆà¸¡à¸µ /procurement prefix)
- Backend à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸™
- Database à¹„à¸¡à¹ˆà¸¡à¸µ users à¸«à¸£à¸·à¸­ password à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

**à¹à¸à¹‰à¹„à¸‚:**
```bash
# 1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š API_URL
grep "API_URL" /var/www/OpenGISData-Thailand/procurement-system/client/src/services/api.js
# à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™: const API_URL = '/procurement/api';

# à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡:
cd /var/www/OpenGISData-Thailand/procurement-system/client/src/services
sed -i "s|const API_URL = '/api';|const API_URL = '/procurement/api';|g" api.js
cd /var/www/OpenGISData-Thailand/procurement-system/client
npm run build

# 2. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š backend
pm2 status
# procurement-backend à¸•à¹‰à¸­à¸‡ status: online

# à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸£à¸±à¸™:
cd /var/www/OpenGISData-Thailand/procurement-system/server
pm2 start server.js --name procurement-backend

# 3. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š database users
cd /var/www/OpenGISData-Thailand/procurement-system/server
sqlite3 data/database/procurement.db "SELECT username, role FROM users;"

# 4. à¸—à¸”à¸ªà¸­à¸š login API
curl -X POST http://localhost/procurement/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password123","role":"admin"}'
```

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 3: 404 à¸«à¸¥à¸±à¸‡ Login

**à¸­à¸²à¸à¸²à¸£:** Login à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸•à¹ˆ redirect à¹„à¸›à¸—à¸µà¹ˆà¸«à¸™à¹‰à¸² 404

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- React Router à¹„à¸¡à¹ˆà¸¡à¸µ `basename="/procurement"`
- Browser cache à¸¢à¸±à¸‡à¹ƒà¸Šà¹‰ JavaScript à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™à¹€à¸à¹ˆà¸²

**à¹à¸à¹‰à¹„à¸‚:**
```bash
# 1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š basename
grep -n "basename" /var/www/OpenGISData-Thailand/procurement-system/client/src/App.jsx
# à¸•à¹‰à¸­à¸‡à¹€à¸«à¹‡à¸™: <Router basename="/procurement">

# à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚à¹ƒà¸™ App.jsx à¹à¸¥à¹‰à¸§ rebuild

# 2. Clear browser cache
# à¸à¸” Ctrl+Shift+Delete à¹à¸¥à¹‰à¸§à¹€à¸¥à¸·à¸­à¸ "Cached images and files"
# à¸«à¸£à¸·à¸­à¸à¸” Ctrl+Shift+R (Hard Refresh)

# 3. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² Nginx serve index.html à¹„à¸”à¹‰
curl -I http://localhost/procurement/dashboard
# Expected: HTTP/1.1 200 OK, Content-Length: 1291
```

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 4: PM2 Backend Crash

**à¸­à¸²à¸à¸²à¸£:** Backend à¸«à¸¢à¸¸à¸”à¸—à¸³à¸‡à¸²à¸™, PM2 status à¹à¸ªà¸”à¸‡ "stopped" à¸«à¸£à¸·à¸­ "errored"

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- Database file permission à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
- Database schema à¹„à¸¡à¹ˆà¸„à¸£à¸š
- Port 3000 à¸–à¸¹à¸à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸­à¸¢à¸¹à¹ˆ

**à¹à¸à¹‰à¹„à¸‚:**
```bash
# à¸”à¸¹ PM2 logs
pm2 logs procurement-backend --lines 50

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š database file
ls -la /var/www/OpenGISData-Thailand/procurement-system/server/data/database/procurement.db

# Set permission
chmod 644 /var/www/OpenGISData-Thailand/procurement-system/server/data/database/procurement.db

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š port 3000
sudo netstat -tlnp | grep 3000

# Restart backend
pm2 restart procurement-backend
pm2 logs procurement-backend
```

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 5: Nginx 502 Bad Gateway

**à¸­à¸²à¸à¸²à¸£:** à¹€à¸‚à¹‰à¸² /procurement/api/* à¹à¸¥à¹‰à¸§à¹„à¸”à¹‰ 502 Bad Gateway

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- Backend à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸™ (PM2 stopped)
- Nginx proxy_pass à¸Šà¸µà¹‰à¸œà¸´à¸” port

**à¹à¸à¹‰à¹„à¸‚:**
```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š backend
pm2 status
pm2 logs procurement-backend

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Nginx config
sudo grep -A 10 "location.*procurement/api" /etc/nginx/sites-available/default
# à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™: proxy_pass http://localhost:3000/api/;

# Test Nginx config
sudo nginx -t

# Restart services
pm2 restart procurement-backend
sudo systemctl reload nginx
```

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 6: Database "no such table: users"

**à¸­à¸²à¸à¸²à¸£:** Login error, logs à¹à¸ªà¸”à¸‡ "no such table: users"

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- Database à¹„à¸¡à¹ˆà¹„à¸”à¹‰ initialize
- à¹ƒà¸Šà¹‰ database file à¸œà¸´à¸”à¸•à¸±à¸§

**à¹à¸à¹‰à¹„à¸‚:**
```bash
cd /var/www/OpenGISData-Thailand/procurement-system/server

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² database à¸¡à¸µà¸•à¸²à¸£à¸²à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
sqlite3 data/database/procurement.db ".tables"

# à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸•à¸²à¸£à¸²à¸‡ à¸•à¹‰à¸­à¸‡ restart backend à¹€à¸à¸·à¹ˆà¸­ initialize
pm2 restart procurement-backend
pm2 logs procurement-backend --lines 30

# à¸„à¸§à¸£à¹€à¸«à¹‡à¸™:
# âœ… Database schema initialized
# âœ… Database seeded successfully
```

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 7: Password à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

**à¸­à¸²à¸à¸²à¸£:** Login à¸”à¹‰à¸§à¸¢ username/password à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¹à¸¥à¹‰à¸§à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- Password à¹ƒà¸™ database à¹€à¸›à¹‡à¸™ placeholder hash (`$2b$10$YourHashedPasswordHere`)
- à¹ƒà¸Šà¹‰ password à¸œà¸´à¸”

**à¹à¸à¹‰à¹„à¸‚:**
```bash
cd /var/www/OpenGISData-Thailand/procurement-system/server

# à¸ªà¸£à¹‰à¸²à¸‡ hash à¸ªà¸³à¸«à¸£à¸±à¸š password123
node -e "const bcrypt = require('bcrypt'); bcrypt.hash('password123', 10, (err, hash) => { console.log(hash); });"

# Update à¸—à¸¸à¸ users (à¹€à¸­à¸² hash à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸¡à¸²à¹ƒà¸ªà¹ˆ)
sqlite3 data/database/procurement.db "UPDATE users SET password = '\$2b\$10\$YOUR_GENERATED_HASH';"

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š
sqlite3 data/database/procurement.db "SELECT username, substr(password,1,30) FROM users LIMIT 3;"
```

### à¸›à¸±à¸à¸«à¸²à¸—à¸µà¹ˆ 8: Git Push 403 Forbidden

**à¸­à¸²à¸à¸²à¸£:** `git push` à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§à¸”à¹‰à¸§à¸¢ HTTP 403

**à¸ªà¸²à¹€à¸«à¸•à¸¸:**
- Branch name à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸š session ID
- Network issues

**à¹à¸à¹‰à¹„à¸‚:**
```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š branch name
git branch --show-current
# à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™: claude/pull-opengis-thailand-setup-018ToN3x1p5eZ6HTy1q4VAAi

# à¸–à¹‰à¸² push à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡ retry
git push -u origin claude/pull-opengis-thailand-setup-018ToN3x1p5eZ6HTy1q4VAAi
# à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ à¸£à¸­ 2 à¸§à¸´à¸™à¸²à¸—à¸µ à¹à¸¥à¹‰à¸§à¸¥à¸­à¸‡à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡
```

---

## à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸šà¸³à¸£à¸¸à¸‡à¸£à¸±à¸à¸©à¸²

### à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸°à¸£à¸°à¸šà¸š

```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š PM2 backend
pm2 status
pm2 logs procurement-backend --lines 20

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Nginx
sudo systemctl status nginx
sudo nginx -t

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š disk space
df -h /var/www/OpenGISData-Thailand/

# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š database size
ls -lh /var/www/OpenGISData-Thailand/procurement-system/server/data/database/procurement.db
```

### Update Code à¸ˆà¸²à¸ Git

```bash
cd /var/www/OpenGISData-Thailand

# Pull latest changes
git pull origin claude/pull-opengis-thailand-setup-018ToN3x1p5eZ6HTy1q4VAAi

# Rebuild frontend
cd procurement-system/client
npm run build

# Restart backend (if needed)
pm2 restart procurement-backend
```

### Backup Database

```bash
# Create backup directory
sudo mkdir -p /var/backups/procurement-system

# Backup database
sudo cp /var/www/OpenGISData-Thailand/procurement-system/server/data/database/procurement.db \
   /var/backups/procurement-system/procurement-$(date +%Y%m%d-%H%M%S).db

# List backups
ls -lh /var/backups/procurement-system/
```

### Restore Database

```bash
# Stop backend
pm2 stop procurement-backend

# Restore from backup
sudo cp /var/backups/procurement-system/procurement-20241124-120000.db \
   /var/www/OpenGISData-Thailand/procurement-system/server/data/database/procurement.db

# Set permissions
sudo chmod 644 /var/www/OpenGISData-Thailand/procurement-system/server/data/database/procurement.db

# Start backend
pm2 start procurement-backend
```

### View Logs

```bash
# PM2 backend logs
pm2 logs procurement-backend
pm2 logs procurement-backend --lines 100 --nostream

# Nginx access logs
sudo tail -50 /var/log/nginx/access.log

# Nginx error logs
sudo tail -50 /var/log/nginx/error.log

# Nginx logs à¸ªà¸³à¸«à¸£à¸±à¸š procurement à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
sudo tail -100 /var/log/nginx/access.log | grep "/procurement"
```

### Restart Services

```bash
# Restart backend only
pm2 restart procurement-backend

# Restart all PM2 processes
pm2 restart all

# Restart Nginx
sudo systemctl restart nginx

# Restart both
pm2 restart procurement-backend && sudo systemctl reload nginx
```

### Update User Password

```bash
cd /var/www/OpenGISData-Thailand/procurement-system/server

# Generate new password hash
node -e "const bcrypt = require('bcrypt'); bcrypt.hash('newpassword123', 10, (err, hash) => { console.log(hash); });"

# Update specific user
sqlite3 data/database/procurement.db "UPDATE users SET password = '\$2b\$10\$NEW_HASH' WHERE username='admin';"

# Verify
sqlite3 data/database/procurement.db "SELECT username, role FROM users WHERE username='admin';"
```

### Clean Rebuild

```bash
cd /var/www/OpenGISData-Thailand/procurement-system/client

# Remove old build
rm -rf dist

# Remove node_modules and reinstall (à¸–à¹‰à¸²à¸ˆà¸³à¹€à¸›à¹‡à¸™)
rm -rf node_modules
npm install

# Build fresh
npm run build

# Set permissions
chmod -R 755 dist
```

### Test Endpoints

```bash
# Test frontend
curl -I http://localhost/procurement/login

# Test API health
curl http://localhost/procurement/api/

# Test login
curl -X POST http://localhost/procurement/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"password123","role":"admin"}'

# Test with external IP
curl -I http://49.231.27.66/procurement/login
```

### Monitor Resources

```bash
# CPU and Memory usage
pm2 monit

# Detailed PM2 info
pm2 show procurement-backend

# System resources
htop  # or top
```

---

## à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Users à¹à¸¥à¸° Credentials

### Default Users (à¸«à¸¥à¸±à¸‡à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¹ƒà¸«à¸¡à¹ˆ)

| Username | Password | Role | Department | Description |
|----------|----------|------|------------|-------------|
| admin | password123 | admin | - | à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š |
| admin_treasury | password123 | admin | Treasury (1) | à¸œà¸¹à¹‰à¸Šà¹ˆà¸§à¸¢à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥ à¸à¸­à¸‡à¸„à¸¥à¸±à¸‡ |
| staff_treasury | password123 | staff | Treasury (1) | à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¸à¸­à¸‡à¸„à¸¥à¸±à¸‡ |
| staff_engineering | password123 | staff | Engineering (2) | à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¸à¸­à¸‡à¸Šà¹ˆà¸²à¸‡ |
| staff_education | password123 | staff | Education (3) | à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¸à¸­à¸‡à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² |
| staff_health | password123 | staff | Public Health (4) | à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¸à¸­à¸‡à¸ªà¸²à¸˜à¸²à¸£à¸“à¸ªà¸¸à¸‚ |
| staff_municipal | password123 | staff | Municipal Admin (5) | à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¸ªà¸³à¸™à¸±à¸à¸›à¸¥à¸±à¸” |
| staff_strategy | password123 | staff | Planning (6) | à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¸à¸­à¸‡à¸§à¸´à¸Šà¸²à¸à¸²à¸£à¹à¸¥à¸°à¹à¸œà¸™à¸‡à¸²à¸™ |
| staff_clerk | password123 | staff | General Affairs (7) | à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆ à¸ªà¸³à¸™à¸±à¸à¸›à¸¥à¸±à¸” |
| executive | password123 | executive | - | à¸›à¸¥à¸±à¸”à¹€à¸—à¸¨à¸šà¸²à¸¥ |
| executive_mayor | password123 | executive | - | à¸™à¸²à¸¢à¸à¹€à¸—à¸¨à¸¡à¸™à¸•à¸£à¸µ |

**âš ï¸ à¸ªà¸³à¸„à¸±à¸:** à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ password à¸—à¸±à¸™à¸—à¸µà¸«à¸¥à¸±à¸‡à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ production!

### Role Permissions

- **admin:** à¸ˆà¸±à¸”à¸à¸²à¸£à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡à¹ƒà¸™à¸£à¸°à¸šà¸š (users, projects, departments)
- **staff:** à¸ˆà¸±à¸”à¸à¸²à¸£à¹‚à¸„à¸£à¸‡à¸à¸²à¸£à¹ƒà¸™à¹à¸œà¸™à¸à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡, à¸­à¸±à¸›à¹€à¸”à¸• progress
- **executive:** à¸”à¸¹à¸£à¸²à¸¢à¸‡à¸²à¸™à¹à¸¥à¸° dashboard, à¹ƒà¸«à¹‰ feedback

---

## Database Schema Overview

### Tables

1. **users** - à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
2. **departments** - à¹à¸œà¸™à¸/à¸à¸­à¸‡
3. **projects** - à¹‚à¸„à¸£à¸‡à¸à¸²à¸£à¸ˆà¸±à¸”à¸‹à¸·à¹‰à¸­à¸ˆà¸±à¸”à¸ˆà¹‰à¸²à¸‡
4. **project_steps** - à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸°à¹‚à¸„à¸£à¸‡à¸à¸²à¸£
5. **sla_templates** - Template à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸•à¸²à¸¡ SLA
6. **sla_config** - à¸à¸²à¸£à¸à¸³à¸«à¸™à¸” SLA à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸•à¹ˆà¸¥à¸°à¸§à¸´à¸˜à¸µà¸ˆà¸±à¸”à¸‹à¸·à¹‰à¸­
7. **comments** - à¸„à¸§à¸²à¸¡à¸„à¸´à¸”à¹€à¸«à¹‡à¸™à¹ƒà¸™à¹‚à¸„à¸£à¸‡à¸à¸²à¸£
8. **notifications** - à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
9. **audit_log** - à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡
10. **sessions** - JWT refresh tokens

### Views

- **v_projects_overview** - à¸ªà¸£à¸¸à¸›à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹‚à¸„à¸£à¸‡à¸à¸²à¸£
- **v_delayed_projects** - à¹‚à¸„à¸£à¸‡à¸à¸²à¸£à¸—à¸µà¹ˆà¸¥à¹ˆà¸²à¸Šà¹‰à¸²
- **v_user_notifications** - à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸‚à¸­à¸‡ user

---

## API Endpoints Overview

### Authentication
- `POST /api/auth/login` - Login
- `POST /api/auth/logout` - Logout
- `GET /api/auth/verify` - Verify JWT token
- `GET /api/auth/me` - Get current user
- `POST /api/auth/refresh` - Refresh access token

### Projects
- `GET /api/projects` - List projects (with filters)
- `GET /api/projects/:id` - Get project details
- `POST /api/projects` - Create project
- `PUT /api/projects/:id` - Update project
- `DELETE /api/projects/:id` - Delete project
- `GET /api/projects/stats` - Get statistics

### Steps
- `GET /api/projects/:id/steps` - Get project steps
- `GET /api/projects/:id/steps/progress` - Get progress
- `PATCH /api/steps/:id/status` - Update step status
- `PUT /api/steps/:id` - Update step
- `GET /api/steps/overdue` - Get overdue steps

### Users
- `GET /api/users` - List users
- `GET /api/users/:id` - Get user
- `POST /api/users` - Create user
- `PUT /api/users/:id` - Update user
- `DELETE /api/users/:id` - Delete user

### Departments
- `GET /api/departments` - List departments
- `GET /api/departments/:id` - Get department

### Uploads
- `POST /api/upload/images` - Upload images
- `POST /api/upload/documents` - Upload documents

### Notifications
- `GET /api/notifications` - List notifications
- `PUT /api/notifications/:id/read` - Mark as read
- `PUT /api/notifications/read-all` - Mark all as read

### Supervisor Reviews
- `POST /api/supervisor-reviews` - Create review
- `GET /api/supervisor-reviews/project/:id` - Get reviews by project
- `GET /api/supervisor-reviews/report` - Get report

---

## Performance Optimization

### Frontend
- à¹ƒà¸Šà¹‰ Vite à¸ªà¸³à¸«à¸£à¸±à¸š fast builds
- Code splitting (manual chunks) à¸ªà¸³à¸«à¸£à¸±à¸š bundle à¸‚à¸™à¸²à¸”à¹ƒà¸«à¸à¹ˆ
- Lazy loading à¸ªà¸³à¸«à¸£à¸±à¸š routes
- Image optimization

### Backend
- SQLite à¹ƒà¸Šà¹‰ indexes à¸ªà¸³à¸«à¸£à¸±à¸š queries à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸šà¹ˆà¸­à¸¢
- Connection pooling
- PM2 cluster mode (à¸–à¹‰à¸²à¸ˆà¸³à¹€à¸›à¹‡à¸™)

### Nginx
- Gzip compression enabled
- Static file caching
- Keep-alive connections

---

## Security Considerations

### Authentication
- JWT tokens with expiration
- Refresh token mechanism
- Password hashing with bcrypt (10 rounds)
- Session management

### API Security
- CORS configured
- Input validation (express-validator)
- SQL injection prevention (parameterized queries)
- XSS protection (React escaping)

### Server Security
- Nginx à¸£à¸±à¸™à¸”à¹‰à¸§à¸¢ www-data user (low privileges)
- Backend à¸£à¸±à¸™à¸”à¹‰à¸§à¸¢ PM2 (process isolation)
- Database file permissions (644)
- Uploads directory outside public web root

### Recommendations
1. à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ default passwords à¸—à¸±à¸™à¸—à¸µ
2. à¹ƒà¸Šà¹‰ HTTPS (SSL/TLS) à¹ƒà¸™ production
3. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² firewall (ufw) à¹ƒà¸«à¹‰à¹€à¸›à¸´à¸”à¹à¸„à¹ˆ port 80, 443
4. Regular security updates (`apt-get update && apt-get upgrade`)
5. Backup database à¹€à¸›à¹‡à¸™à¸›à¸£à¸°à¸ˆà¸³

---

## Monitoring à¹à¸¥à¸° Alerts

### PM2 Monitoring

```bash
# Real-time monitoring
pm2 monit

# Show detailed info
pm2 show procurement-backend

# Enable web dashboard (optional)
pm2 web
# Access at http://localhost:9615
```

### Log Rotation

PM2 à¸¡à¸µ built-in log rotation:

```bash
# Install PM2 log rotate module
pm2 install pm2-logrotate

# Configure
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

### Health Check Script

à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `/var/www/OpenGISData-Thailand/procurement-system/health-check.sh`:

```bash
#!/bin/bash

echo "=== Procurement System Health Check ==="
echo ""

# Check PM2
echo "1. PM2 Status:"
pm2 status procurement-backend | grep procurement-backend
echo ""

# Check Nginx
echo "2. Nginx Status:"
sudo systemctl is-active nginx
echo ""

# Check Frontend
echo "3. Frontend Test:"
curl -s -o /dev/null -w "HTTP Code: %{http_code}\n" http://localhost/procurement/login
echo ""

# Check API
echo "4. API Test:"
curl -s http://localhost/procurement/api/ | grep -o '"success":true' || echo "API Error"
echo ""

# Check Database
echo "5. Database:"
ls -lh /var/www/OpenGISData-Thailand/procurement-system/server/data/database/procurement.db
echo ""

# Check Disk Space
echo "6. Disk Space:"
df -h /var/www | tail -1
echo ""

echo "=== Health Check Complete ==="
```

à¹ƒà¸Šà¹‰à¸‡à¸²à¸™:
```bash
chmod +x /var/www/OpenGISData-Thailand/procurement-system/health-check.sh
/var/www/OpenGISData-Thailand/procurement-system/health-check.sh
```

---

## Scaling Considerations

### Horizontal Scaling
- à¹ƒà¸Šà¹‰ PM2 cluster mode à¸ªà¸³à¸«à¸£à¸±à¸š multi-core
- Load balancer à¸–à¹‰à¸²à¸¡à¸µà¸«à¸¥à¸²à¸¢ servers
- Separate database server

### Vertical Scaling
- à¹€à¸à¸´à¹ˆà¸¡ RAM à¸ªà¸³à¸«à¸£à¸±à¸š Node.js processes
- à¹€à¸à¸´à¹ˆà¸¡ CPU cores à¸ªà¸³à¸«à¸£à¸±à¸š PM2 cluster
- SSD à¸ªà¸³à¸«à¸£à¸±à¸š database I/O

### Database Scaling
- à¸à¸´à¸ˆà¸²à¸£à¸“à¸²à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™ PostgreSQL à¸«à¸£à¸·à¸­ MySQL à¸ªà¸³à¸«à¸£à¸±à¸š production à¹ƒà¸«à¸à¹ˆ
- Database replication
- Caching layer (Redis)

---

## Known Issues à¹à¸¥à¸° Limitations

### Current Limitations

1. **Database:** à¹ƒà¸Šà¹‰ SQLite à¸‹à¸¶à¹ˆà¸‡à¹„à¸¡à¹ˆà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸š high-concurrency
   - **Solution:** à¸à¸´à¸ˆà¸²à¸£à¸“à¸²à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™ PostgreSQL

2. **File Uploads:** à¹€à¸à¹‡à¸šà¸šà¸™ local filesystem
   - **Solution:** à¹ƒà¸Šà¹‰ S3-compatible storage

3. **No HTTPS:** à¹ƒà¸Šà¹‰ HTTP à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
   - **Solution:** à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Let's Encrypt SSL certificate

4. **Single Server:** à¹„à¸¡à¹ˆà¸¡à¸µ redundancy
   - **Solution:** Deploy multi-server with load balancer

5. **No Real-time Updates:** à¸•à¹‰à¸­à¸‡ refresh à¸«à¸™à¹‰à¸²à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆ
   - **Solution:** à¹€à¸à¸´à¹ˆà¸¡ WebSocket (Socket.io)

---

## Development Environment Setup

à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ develop locally:

```bash
# Clone repository
git clone https://github.com/bogarb12/OpenGISData-Thailand.git
cd OpenGISData-Thailand/procurement-system

# Frontend
cd client
npm install
npm run dev  # à¸£à¸±à¸™à¸—à¸µà¹ˆ http://localhost:3001

# Backend (terminal à¹ƒà¸«à¸¡à¹ˆ)
cd server
npm install
node server.js  # à¸£à¸±à¸™à¸—à¸µà¹ˆ http://localhost:3000

# à¹€à¸›à¸´à¸” browser à¸—à¸µà¹ˆ http://localhost:3001
```

**à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸:** Dev environment à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ `/procurement` prefix à¹€à¸à¸£à¸²à¸° Vite dev server à¸¡à¸µ proxy

---

## CI/CD Pipeline (Future)

à¹à¸™à¸§à¸—à¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸š automated deployment:

```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '20'

      - name: Build Frontend
        run: |
          cd client
          npm install
          npm run build

      - name: Deploy to Server
        run: |
          # SSH to server and update
          # rsync files
          # Restart PM2
```

---

## à¸•à¸´à¸”à¸•à¹ˆà¸­à¹à¸¥à¸°à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™

### Repository
- **GitHub:** https://github.com/bogarb12/OpenGISData-Thailand
- **Branch:** claude/pull-opengis-thailand-setup-018ToN3x1p5eZ6HTy1q4VAAi

### Documentation Files
- `DEPLOYMENT_GUIDE.md` - à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰
- `DEPLOYMENT_SUCCESS.md` - Deployment summary
- `README.md` - Project overview

### Quick Reference Card

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PROCUREMENT SYSTEM QUICK REFERENCE              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Production URL: http://49.231.27.66/procurement/           â”‚
â”‚ Default Login:  admin / password123 / à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PATHS:                                                      â”‚
â”‚  â€¢ App:      /var/www/OpenGISData-Thailand/procurement-    â”‚
â”‚              system/                                        â”‚
â”‚  â€¢ Frontend: /var/www/html/procurement (symlink)           â”‚
â”‚  â€¢ Database: /var/www/OpenGISData-Thailand/procurement-    â”‚
â”‚              system/server/data/database/procurement.db    â”‚
â”‚  â€¢ Logs:     ~/.pm2/logs/ or pm2 logs procurement-backend  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMMON COMMANDS:                                            â”‚
â”‚  â€¢ Status:   pm2 status                                     â”‚
â”‚  â€¢ Logs:     pm2 logs procurement-backend                   â”‚
â”‚  â€¢ Restart:  pm2 restart procurement-backend                â”‚
â”‚  â€¢ Rebuild:  cd client && npm run build                     â”‚
â”‚  â€¢ Database: sqlite3 server/data/database/procurement.db    â”‚
â”‚  â€¢ Nginx:    sudo nginx -t && sudo systemctl reload nginx   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TROUBLESHOOTING:                                            â”‚
â”‚  â€¢ 404 on assets â†’ chmod -R 755 client/dist                 â”‚
â”‚  â€¢ Login fails â†’ Check api.js API_URL='/procurement/api'   â”‚
â”‚  â€¢ 404 after login â†’ Check App.jsx basename="/procurement" â”‚
â”‚  â€¢ 502 error â†’ pm2 restart procurement-backend              â”‚
â”‚  â€¢ Clear cache â†’ Ctrl+Shift+R in browser                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Changelog

### Version 1.0 (2024-11-24)
- âœ… Initial deployment à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
- âœ… Support subdirectory deployment (`/procurement/`)
- âœ… Nginx root + symlink configuration
- âœ… React Router basename setup
- âœ… API prefix configuration
- âœ… Database initialization à¹à¸¥à¸° seeding
- âœ… User authentication à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰
- âœ… PM2 process management
- âœ… Automated clean install script
- âœ… Diagnostic tools
- âœ… Complete documentation

---

## à¸ªà¸£à¸¸à¸›

à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰à¸„à¸£à¸­à¸šà¸„à¸¥à¸¸à¸¡à¸—à¸¸à¸à¹à¸‡à¹ˆà¸¡à¸¸à¸¡à¸‚à¸­à¸‡ Procurement System deployment:

1. âœ… **à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡** - à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ flow à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
2. âœ… **Configuration** - à¹„à¸Ÿà¸¥à¹Œà¸ªà¸³à¸„à¸±à¸à¹à¸¥à¸°à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²
3. âœ… **Subdirectory Deployment** - à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸„à¸§à¸²à¸¡à¸—à¹‰à¸²à¸—à¸²à¸¢à¹à¸¥à¸°à¸§à¸´à¸˜à¸µà¹à¸à¹‰
4. âœ… **Installation** - à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¹à¸šà¸š automated à¹à¸¥à¸° manual
5. âœ… **Troubleshooting** - à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸±à¹ˆà¸§à¹„à¸›
6. âœ… **Maintenance** - à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸šà¸³à¸£à¸¸à¸‡à¸£à¸±à¸à¸©à¸²
7. âœ… **Security** - à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
8. âœ… **Monitoring** - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸£à¸°à¸šà¸š

**à¸­à¹ˆà¸²à¸™à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰à¹à¸¥à¹‰à¸§à¸ˆà¸°à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸—à¸±à¹‰à¸‡à¸£à¸°à¸šà¸šà¹à¸¥à¸°à¸ªà¸²à¸¡à¸²à¸£à¸– deploy à¹„à¸”à¹‰à¹€à¸­à¸‡** ğŸ‰

---

*Last Updated: 2024-11-24*
*Document Version: 1.0*
*Author: Claude Code AI Assistant*
